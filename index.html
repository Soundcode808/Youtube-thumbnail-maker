<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
      /* --- [1] ê¸°ë³¸ ì„¤ì • --- */
      body { 
        font-family: 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; 
        background: #121212; 
        display: flex; flex-direction: column; align-items: center; padding: 20px; color: #e0e0e0;
        user-select: none; 
        -webkit-user-select: none;
        -webkit-tap-highlight-color: transparent;
        height: 100vh;
        box-sizing: border-box;
        overflow: hidden; 
      }
      
      * { -ms-overflow-style: none; scrollbar-width: none; }
      *::-webkit-scrollbar { display: none; }
      
      input, textarea, select { user-select: text; -webkit-user-select: text; }
      .hidden-file-input { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; opacity: 0; z-index: -1; }

      .container { 
          background: #1e1e1e; 
          padding: 20px; 
          border-radius: 12px; 
          box-shadow: 0 15px 40px rgba(0,0,0,0.7); 
          max-width: 1600px;
          width: 100%; 
          height: calc(100vh - 40px);
          display: grid; 
          grid-template-rows: auto 1fr; 
          gap: 15px; 
          box-sizing: border-box;
      }

      /* í—¤ë” ì˜ì—­ */
      .header-area { text-align: center; flex-shrink: 0; position: relative; }
      
      .header-controls {
          position: absolute;
          top: 0;
          right: 0;
          z-index: 200;
          display: flex;
          flex-direction: column; 
          align-items: flex-end;
          gap: 8px;
      }

      .lang-selector select {
          padding: 6px 10px;
          background: #333;
          color: #fff;
          border: 1px solid #555;
          border-radius: 6px;
          font-size: 12px;
          cursor: pointer;
          outline: none;
      }
      .lang-selector select:hover { background: #444; }

      .social-links {
          display: flex;
          gap: 10px;
          background: rgba(255, 255, 255, 0.05);
          padding: 6px 10px;
          border-radius: 8px;
          border: 1px solid rgba(255,255,255,0.1);
          backdrop-filter: blur(4px);
      }
      .social-btn {
          color: #888;
          font-size: 16px;
          transition: all 0.2s;
          text-decoration: none;
          display: flex; align-items: center; justify-content: center;
      }
      .social-btn:hover { transform: scale(1.2); }
      .social-btn:hover .fa-tree { color: #43e660; }
      .social-btn:hover .fa-youtube { color: #ff0000; }
      .social-btn:hover .fa-threads { color: #fff; }
      .social-btn:hover .fa-instagram { color: #d62976; }

      h2 { margin-bottom: 5px; color: #fff; font-size: 28px; font-weight: 700; letter-spacing: -0.5px; margin-top: 0; }
      h2 i { color: #ff0000; margin-right: 10px; }

      /* --- [2] 3ë‹¨ ë ˆì´ì•„ì›ƒ --- */
      .workspace {
          display: grid;
          /* ì™¼ìª½(340px) - ì¤‘ì•™(ê°€ë³€) - ì˜¤ë¥¸ìª½(320px) */
          grid-template-columns: 340px 1fr 320px; 
          gap: 20px;
          height: 100%;
          overflow: hidden; 
          min-height: 0;
      }

      /* 1. ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
      .control-panel { overflow-y: auto; padding-right: 5px; height: 100%; padding-bottom: 50px; }

      /* â˜… ê´€ë¦¬ì ë„êµ¬ (ì™¼ìª½ ìƒë‹¨ ë°°ì¹˜) */
      .admin-tools {
          background: #2a2a2a;
          border: 2px dashed #FFD700;
          border-radius: 8px;
          padding: 15px;
          margin-bottom: 20px;
          text-align: center;
      }
      .admin-title { color: #FFD700; font-weight: bold; margin-bottom: 10px; display: block; font-size: 14px; }
      
      /* 2. ì¤‘ì•™ ìº”ë²„ìŠ¤ ì˜ì—­ */
      .center-panel-wrapper {
          display: flex; flex-direction: column; height: 100%; overflow: hidden; position: relative;
          background: #181818; border-radius: 12px; border: 1px solid #333;
      }
      .quick-menu {
          display: flex; gap: 10px; width: 100%; justify-content: space-between;
          flex-shrink: 0; z-index: 10; background: #252525; padding: 10px; box-sizing: border-box; border-bottom: 1px solid #333;
      }
      .quick-btn {
          flex: 1; background: #2a2a2a; color: #aaa; border: 1px solid #444; padding: 8px; border-radius: 6px;
          cursor: pointer; font-size: 13px; font-weight: 600; text-align: center; transition: all 0.2s;
          display: flex; flex-direction: column; align-items: center; gap: 4px;
      }
      .quick-btn:hover { background: #333; color: #fff; }
      .quick-btn.active { background: #3ea6ff; color: #000; border-color: #3ea6ff; }

      .canvas-scroll-area { 
          flex: 1; display: flex; flex-direction: column; overflow-y: auto; padding: 20px; box-sizing: border-box; position: relative;
      }
      #canvas-wrapper { 
          width: 100%; max-width: 100%; aspect-ratio: 16/9; max-height: 60vh; 
          border-radius: 12px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5); border: 1px solid #444; background: #000; 
          margin: auto; margin-bottom: 15px; 
          display: flex; justify-content: center; align-items: center; position: relative; cursor: crosshair; touch-action: none; flex-shrink: 0;
      }
      .canvas-actions { width: 100%; margin: 0 auto; display: flex; flex-direction: column; gap: 10px; flex-shrink: 0; padding-bottom: 20px; }
      
      @supports not (aspect-ratio: 16/9) { #canvas-wrapper { height: 0; padding-bottom: 56.25%; } }
      canvas { max-width: 100%; max-height: 100%; object-fit: contain; }

      /* â˜… ê¸°ë¶€ ì˜ì—­ (ì¤‘ì•™ í•˜ë‹¨ìœ¼ë¡œ ì´ë™) */
      .donation-area { 
          margin-top: 20px; 
          padding-top: 15px; 
          border-top: 1px dashed #444; 
          text-align: center; 
      }
      .donation-area h4 { font-size: 14px; margin-bottom: 10px; color: #FFD700; }
      .qr-wrapper { 
          display: inline-block; 
          padding: 10px; 
          background: #fff; 
          border-radius: 12px; 
          border: 4px solid #FFD700; 
          text-align: center; 
          box-sizing: border-box;
      }
      .qr-img { width: 100%; max-width: 150px; height: auto; display: block; margin: 0 auto; }

      /* 3. ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” */
      .right-sidebar {
          background: #222;
          border-radius: 12px;
          padding: 15px;
          border: 1px solid #333;
          overflow-y: auto;
          display: flex;
          flex-direction: column;
          gap: 20px;
      }

      .youtube-card {
          background: #1a1a1a;
          border-radius: 10px;
          overflow: hidden;
          border: 1px solid #444;
          box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      }
      .yt-header {
          padding: 10px;
          background: #333;
          display: flex;
          align-items: center;
          gap: 8px;
          font-weight: bold;
          font-size: 13px;
          color: #fff;
          border-bottom: 1px solid #444;
      }
      .yt-header i { color: #ff0000; }
      
      .video-container {
          position: relative;
          width: 100%;
          padding-bottom: 56.25%;
          background: #000;
          cursor: pointer;
          overflow: hidden;
      }
      .video-container img {
          position: absolute;
          top: 0; left: 0; width: 100%; height: 100%;
          object-fit: cover;
          opacity: 0.9;
          transition: opacity 0.3s;
      }
      .video-container:hover img { opacity: 1; }
      
      .play-button {
          position: absolute;
          top: 50%; left: 50%;
          transform: translate(-50%, -50%);
          width: 50px; height: 50px;
          background: rgba(0,0,0,0.7);
          border-radius: 50%;
          display: flex; justify-content: center; align-items: center;
          border: 2px solid #fff;
          transition: all 0.2s;
          pointer-events: none;
      }
      .play-button i { color: #fff; font-size: 20px; margin-left: 3px; }
      .video-container:hover .play-button { background: #ff0000; border-color: #ff0000; transform: translate(-50%, -50%) scale(1.1); }
      
      .video-container iframe {
          position: absolute;
          top: 0; left: 0; width: 100%; height: 100%;
          border: none;
      }

      .video-info { padding: 12px; }
      .video-title { font-size: 13px; font-weight: 600; line-height: 1.4; margin-bottom: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; color: #fff; }
      .video-date { font-size: 11px; color: #888; }

      /* --- [3] UI ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ìœ ì§€) --- */
      .section { background: #2a2a2a; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; overflow: hidden; transition: all 0.3s ease; }
      .section-header { padding: 15px; background: #333; cursor: pointer; display: flex; align-items: center; justify-content: space-between; user-select: none; }
      .section-header:hover { background: #3a3a3a; }
      .section-title { font-size: 14px; font-weight: 700; color: #f0f0f0; display: flex; align-items: center; gap: 8px; }
      .section.collapsed .section-content { display: none; }
      .section.collapsed .section-toggle-icon { transform: rotate(-90deg); }
      .section-toggle-icon { transition: transform 0.3s; color: #888; }
      .section-content { padding: 15px; border-top: 1px solid #333; }
      
      label { display: block; font-size: 11px; margin-bottom: 4px; color: #aaa; font-weight: 600; }
      input[type="text"], input[type="number"], select { width: 100%; padding: 10px; background: #121212; border: 1px solid #444; color: white; border-radius: 4px; box-sizing: border-box; margin-bottom: 8px; font-size: 13px; }
      input[type="range"] { width: 100%; cursor: pointer; accent-color: #3ea6ff; margin-bottom: 8px; height: 4px; background: #444; border-radius: 2px; }

      .btn { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 14px; box-sizing: border-box; }
      .btn-primary { background: #3ea6ff; color: #000; margin-bottom: 10px; }
      .btn-secondary { background: #555; color: #fff; margin-bottom: 5px; font-size: 12px; padding: 10px; }
      .btn-success { background: #2ba640; color: white; font-size: 16px; padding: 15px; box-shadow: 0 4px 12px rgba(43, 166, 64, 0.3); }
      .btn-upload { background: #333; color: #ccc; border: 1px solid #444; }
      .btn-dist { background: #FFD700; color: #000; margin-top:10px; }
      .btn-small { width: auto; padding: 6px 12px; margin-bottom: 0; margin-left: 5px; font-size: 11px; }
      
      .toggle-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; padding: 4px 0; }
      .toggle-label { font-size: 13px; color: #ccc; display: flex; align-items: center; gap: 6px; }
      input[type="checkbox"] { width: 18px; height: 18px; accent-color: #3ea6ff; cursor: pointer; }

      .color-palette { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px; }
      .color-swatch { width: 24px; height: 24px; border-radius: 4px; cursor: pointer; border: 1px solid #555; transition: transform 0.1s; }
      .color-swatch:hover { transform: scale(1.1); border-color: #fff; }
      .custom-palette-area { margin-top: 5px; border-top: 1px dashed #444; padding-top: 5px; }
      .custom-label span { font-size: 10px; color: #888; }
      .color-input-wrapper { display: flex; align-items: center; gap: 5px; background: #181818; padding: 6px 10px; border-radius: 4px; border: 1px solid #444; margin-bottom: 8px; }
      input[type="color"] { width: 30px; height: 30px; border: none; background: none; cursor: pointer; padding: 0; flex-shrink: 0; }

      .text-layer { background: #333; padding: 15px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #3ea6ff; position: relative; }
      .remove-btn { position: absolute; top: 8px; right: 8px; background: none; border: none; color: #ff5252; cursor: pointer; font-size: 14px; padding: 5px; }
      .style-group { display: flex; gap: 5px; margin-bottom: 8px; }
      .style-btn { flex: 1; background: #444; border: 1px solid #555; color: #aaa; padding: 10px; border-radius: 4px; cursor: pointer; font-size: 14px; }
      .style-btn.active { background: #3ea6ff; color: #000; border-color: #3ea6ff; font-weight: bold; }
      
      .preset-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 10px; }
      .preset-btn { background: #3a3a3a; color: #e0e0e0; font-size: 12px; padding: 12px 5px; border-radius: 6px; border: 1px solid #444; cursor: pointer; text-align: center; transition: 0.2s; display: flex; flex-direction: column; align-items: center; gap: 6px; }

      .font-manager { background: #222; padding: 12px; border-radius: 6px; border: 1px dashed #555; margin-bottom: 15px; }
      .bg-control-panel { margin-top: 15px; background: #222; padding: 12px; border-radius: 6px; border: 1px solid #444; display: none; }
      .bg-control-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
      .mini-input-group { display: flex; align-items: center; gap: 5px; }
      
      .scale-slider-container { margin-top: 10px; padding: 10px; background: #1a1a1a; border-radius: 4px; border: 1px solid #333; display: none; }
      .sub-option-box { background: #252525; padding: 10px; border-radius: 6px; margin-top: 5px; border-left: 2px solid #555; font-size: 12px; }

      @media (max-width: 1400px) {
          .workspace { grid-template-columns: 340px 1fr; }
          .right-sidebar { display: none; }
          .container { max-width: 1200px; }
      }
      
      @media (max-width: 900px) {
        body { height: auto; overflow: auto; }
        .container { display: flex; flex-direction: column; height: auto; }
        .workspace { display: flex; flex-direction: column; height: auto; overflow: visible; }
        .control-panel { height: auto; padding-right: 0; }
        .center-panel-wrapper { height: auto; overflow: visible; border: none; background: transparent; }
        .canvas-scroll-area { overflow: visible; height: auto; padding: 0; }
        .center-panel-wrapper { order: 1; margin-bottom: 10px; }
        .control-panel { order: 2; }
        .right-sidebar { display: flex; order: 3; }
        .quick-menu { position: sticky; top: 0; z-index: 100; padding: 10px 0; margin-bottom: 0; background: #121212; border: none; }
        
        .header-area { display: flex; flex-direction: column; align-items: center; }
        .header-controls { position: relative; top: auto; right: auto; width: 100%; flex-direction: row; justify-content: flex-end; align-items: center; margin-bottom: 10px; gap: 15px; }
        h2 { font-size: 20px !important; }
        #canvas-wrapper { max-height: none; }
      }
    </style>
    <script>
        document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
        document.onkeydown = function(e) {
            if(e.keyCode == 123 || (e.ctrlKey && (e.keyCode == 'I'.charCodeAt(0) || e.keyCode == 'J'.charCodeAt(0) || e.keyCode == 'U'.charCodeAt(0) || e.keyCode == 'S'.charCodeAt(0)))) {
                if(e.ctrlKey && e.keyCode == 'S'.charCodeAt(0)) {
                    e.preventDefault();
                    alert("í˜ì´ì§€ ì €ì¥ì´ ì°¨ë‹¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. 'ì¸ë„¤ì¼ ì €ì¥í•˜ê¸°' ë²„íŠ¼ì„ ì´ìš©í•´ì£¼ì„¸ìš”.");
                    return false;
                }
                return false;
            }
        }
        document.onselectstart = function() { return false; };
    </script>
  </head>
  <body>
    <div class="container">
      <div class="header-area">
          <div class="header-controls">
              <div class="lang-selector">
                  <select onchange="changeLanguage(this.value)">
                      <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                      <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                      <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                      <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                  </select>
              </div>
              <div class="social-links">
                  <a href="https://linktr.ee/soundcode808" target="_blank" class="social-btn" title="Linktree"><i class="fas fa-tree"></i></a>
                  <a href="https://www.youtube.com/@soundcode606" target="_blank" class="social-btn" title="YouTube"><i class="fab fa-youtube"></i></a>
                  <a href="https://www.threads.net/@soundcode808" target="_blank" class="social-btn" title="Threads"><i class="fab fa-threads"></i></a>
                  <a href="https://www.instagram.com/soundcode808/" target="_blank" class="social-btn" title="Instagram"><i class="fab fa-instagram"></i></a>
              </div>
          </div>
          <h2 style="margin-bottom: 0px; font-size: 32px;"><i class="fab fa-youtube"></i> <span data-lang="title">ë”¸ê¹ ìœ íŠœë¸Œ ì¸ë„¤ì¼ ë©”ì´ì»¤ V31</span></h2>
          <div style="text-align: center; margin-bottom: 5px; margin-top: 5px; color: #FFD700; font-size: 18px; font-weight: bold; letter-spacing: 1px; opacity: 0.9;">
              <span data-lang="subtitle">[ ë¬´ë‹¨ ìˆ˜ì •, ë³µì œ, ì¬ë°°í¬ ê¸ˆì§€ ]</span>
          </div>
      </div>

      <div class="workspace">
        <!-- 1. ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="control-panel" id="mainControlPanel">
            
            <!-- â˜… ì™¼ìª½ ìƒë‹¨: ê´€ë¦¬ì ë°°í¬ ë„êµ¬ -->
            <div class="admin-tools" id="adminToolsPanel">
                <span class="admin-title">ğŸ‘‘ ë°°í¬ íŒŒì¼ ìƒì„±ê¸° (ì£¼ì¸ì¥ ì „ìš©)</span>
                
                <!-- ìœ íŠœë¸Œ ì±„ë„ ID -->
                <div style="margin-bottom: 10px; text-align: left;">
                    <label style="color:#aaa; font-size:11px;">ìœ íŠœë¸Œ ì±„ë„ ID (ìë™ ì¬ìƒìš©)</label>
                    <input type="text" id="adminChannelId" placeholder="UC..." style="width:100%; box-sizing:border-box;">
                </div>

                <!-- QR ì½”ë“œ ì—…ë¡œë“œ & ì €ì¥ ë²„íŠ¼ -->
                <label style="color:#FFD700; font-size:12px; display:block; margin-bottom:5px;">QR ì½”ë“œ ì´ë¯¸ì§€ ì„ íƒ & ì €ì¥</label>
                <input type="file" id="qrUploadInput" accept="image/*" class="hidden-file-input" onchange="makeSingleFile(this)">
                <label for="qrUploadInput" class="btn btn-dist">
                    <i class="fas fa-file-export"></i> ì´ë¯¸ì§€ ì„ íƒ & HTML ì €ì¥
                </label>
                <p style="font-size:11px; color:#888; margin-top:5px; margin-bottom:0;">* ì„ íƒ ì¦‰ì‹œ ì ìš© ë° ë‹¤ìš´ë¡œë“œ ë©ë‹ˆë‹¤.</p>
            </div>

            <!-- ê¸°ì¡´ ì»¨íŠ¸ë¡¤ íŒ¨ë„ ë‚´ìš©ë“¤ -->
            <div class="section" id="section-bg">
                <div class="section-header" onclick="toggleSection('section-bg')">
                    <div class="section-title"><i class="fas fa-image"></i> <span data-lang="section_bg">ë°°ê²½ & ì•ˆì „ ì˜ì—­</span></div>
                    <i class="fas fa-chevron-down section-toggle-icon"></i>
                </div>
                <div class="section-content">
                    <input type="file" id="imageLoader" accept="image/*" class="hidden-file-input" onchange="handleImageUpload(this)">
                    <label for="imageLoader" class="btn btn-upload"><i class="fas fa-folder-open"></i> <span data-lang="btn_load_img">ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°</span></label>
                    <!-- ... (ë‚˜ë¨¸ì§€ ë°°ê²½ ì»¨íŠ¸ë¡¤ ìƒëµ - ì´ì „ê³¼ ë™ì¼) ... -->
                    <div id="bgControlPanel" class="bg-control-panel">
                        <div class="toggle-row" style="margin-bottom:10px; padding-bottom:5px; border-bottom:1px solid #444;">
                            <span class="toggle-label" style="color:#FFD700; font-weight:bold;"><i class="fas fa-lock"></i> <span data-lang="label_lock">ì´ë¯¸ì§€ ì ê¸ˆ (Lock)</span></span>
                            <input type="checkbox" id="bgLock" onchange="updateBgLock()" checked>
                        </div>
                        <label data-lang="label_size">í¬ê¸° ì¡°ì ˆ (Width / Height)</label>
                        <div class="bg-control-grid">
                            <div class="mini-input-group"><span style="font-size:11px; color:#888;">W</span><input type="number" id="bgWidth" oninput="updateBgSize('w')"></div>
                            <div class="mini-input-group"><span style="font-size:11px; color:#888;">H</span><input type="number" id="bgHeight" oninput="updateBgSize('h')"></div>
                        </div>
                        <div class="toggle-row" style="margin-top:5px;">
                            <span class="toggle-label" data-lang="label_ratio">ë¹„ìœ¨ ê³ ì • (Aspect Ratio)</span>
                            <input type="checkbox" id="bgRatio" checked onchange="toggleScaleSlider()">
                        </div>
                        <div id="scaleSliderArea" class="scale-slider-container">
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><label style="margin:0; color:#3ea6ff;" data-lang="label_zoom">ğŸš€ ì „ì²´ í¬ê¸° ì¡°ì ˆ (Zoom)</label><span id="scaleValue" style="font-size:11px; color:#aaa;">100%</span></div>
                            <input type="range" id="bgScaleSlider" min="10" max="300" value="100" oninput="updateBgScale(this.value)">
                        </div>
                        <label style="margin-top:10px;" data-lang="label_pos">ìœ„ì¹˜ ì´ë™ (X / Y)</label>
                        <div class="bg-control-grid">
                            <div class="mini-input-group"><span style="font-size:11px; color:#888;">X</span><input type="number" id="bgX" oninput="updateBgPos('input')"></div>
                            <div class="mini-input-group"><span style="font-size:11px; color:#888;">Y</span><input type="number" id="bgY" oninput="updateBgPos('input')"></div>
                        </div>
                        <div style="margin-top:5px; padding:8px; background:#181818; border-radius:6px; border:1px solid #333;">
                            <div style="display:flex; align-items:center; gap:8px; margin-bottom:5px;"><span style="font-size:11px; color:#aaa; width:15px; font-weight:bold;">â†”</span><input type="range" id="bgXSlider" min="-1500" max="1500" value="0" oninput="updateBgPos('slider')"></div>
                            <div style="display:flex; align-items:center; gap:8px;"><span style="font-size:11px; color:#aaa; width:15px; font-weight:bold;">â†•</span><input type="range" id="bgYSlider" min="-1000" max="1000" value="0" oninput="updateBgPos('slider')"></div>
                        </div>
                        <button class="btn btn-secondary" onclick="resetBgImage()" style="margin-top:10px; background:#444; border-color:#555;"><i class="fas fa-undo-alt"></i> <span data-lang="btn_reset">ì´ë¯¸ì§€ í¬ê¸°/ìœ„ì¹˜ ì´ˆê¸°í™”</span></button>
                    </div>
                    <!-- ... -->
                    <div style="margin-top: 15px; border-top: 1px solid #444; padding-top: 10px;">
                        <div class="toggle-row"><span class="toggle-label"><i class="fas fa-eye"></i> <span data-lang="label_safezone">ì‹œê°„ í‘œì‹œ (Safe Zone)</span></span><input type="checkbox" id="checkSafeZone" onchange="drawCanvas()" checked></div>
                        <div class="toggle-row" style="margin-left: 10px;"><span class="toggle-label"><i class="fas fa-music"></i> <span data-lang="label_music">ìŒí‘œ ì•„ì´ì½˜ (ë®¤ì§ë¹„ë””ì˜¤)</span></span><input type="checkbox" id="checkMusicIcon" onchange="drawCanvas()"></div>
                        <div class="toggle-row" style="margin-top: 10px;"><span class="toggle-label"><i class="fas fa-border-all"></i> <span data-lang="label_grid3">3ë¶„í•  ê·¸ë¦¬ë“œ (ìì„)</span></span><input type="checkbox" id="checkGrid3" onchange="toggleGrid(3)"></div>
                        <div class="toggle-row"><span class="toggle-label"><i class="fas fa-th"></i> <span data-lang="label_grid6">6ë¶„í•  ê·¸ë¦¬ë“œ (ìì„)</span></span><input type="checkbox" id="checkGrid6" onchange="toggleGrid(6)"></div>
                    </div>
                </div>
            </div>
            <!-- (Other Sections maintained) -->
            <div class="section collapsed" id="section-layout"><div class="section-header" onclick="toggleSection('section-layout')"><div class="section-title"><i class="fas fa-chart-line"></i> <span data-lang="section_layout">í´ë¦­ ë¶€ë¥´ëŠ” 6ê°€ì§€ ë°°ì¹˜</span></div><i class="fas fa-chevron-down section-toggle-icon"></i></div><div class="section-content"><div class="preset-grid"><div class="preset-btn" onclick="applyPreset('center-big')"><i class="fas fa-bullseye"></i> <span data-lang="preset_center">ì¤‘ì•™ ì´ˆëŒ€í˜•</span></div><div class="preset-btn" onclick="applyPreset('left-hook')"><i class="fas fa-align-left"></i> <span data-lang="preset_hook">ì¢Œì¸¡ í›…(Hook)</span></div><div class="preset-btn" onclick="applyPreset('split-contrast')"><i class="fas fa-columns"></i> <span data-lang="preset_split">ì¢Œìš° ë¶„í• </span></div><div class="preset-btn" onclick="applyPreset('bottom-story')"><i class="fas fa-quote-left"></i> <span data-lang="preset_bottom">í•˜ë‹¨ ìë§‰í˜•</span></div><div class="preset-btn" onclick="applyPreset('corner-badge')"><i class="fas fa-certificate"></i> <span data-lang="preset_badge">ì¢Œìƒë‹¨ ë±ƒì§€</span></div><div class="preset-btn" onclick="applyPreset('diagonal-dynamic')"><i class="fas fa-slash"></i> <span data-lang="preset_diagonal">ëŒ€ê°ì„  ë°°ì¹˜</span></div></div></div></div>
            <div class="section collapsed" id="section-effect"><div class="section-header" onclick="toggleSection('section-effect')"><div class="section-title"><i class="fas fa-wand-magic-sparkles"></i> <span data-lang="section_effect">ë””ìì¸ íš¨ê³¼</span></div><i class="fas fa-chevron-down section-toggle-icon"></i></div><div class="section-content"><div class="toggle-row"><span class="toggle-label" data-lang="label_shadow">ğŸ¬ ì‹œë„¤ë§ˆí‹± ê·¸ë¦¼ì (í•˜ë‹¨)</span><input type="checkbox" id="checkGradient" onchange="drawCanvas()" checked></div><input type="range" id="gradIntensity" min="0" max="100" value="70" oninput="drawCanvas()"><hr style="border: 0; border-top: 1px solid #444; margin: 10px 0;"><div class="toggle-row"><span class="toggle-label" data-lang="label_border">ğŸ–¼ï¸ ì¸ë„¤ì¼ í…Œë‘ë¦¬</span><input type="checkbox" id="checkBorder" onchange="drawCanvas()"></div><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;"><div><label data-lang="label_thickness">ë‘ê»˜</label><input type="number" id="borderWidth" value="15" oninput="drawCanvas()"></div><div><label data-lang="label_radius">ë¼ìš´ë”©</label><input type="number" id="borderRadius" value="30" oninput="drawCanvas()"></div></div><label style="margin-top:5px;" data-lang="label_border_color">í…Œë‘ë¦¬ ìƒ‰ìƒ</label><div class="color-palette" id="borderPalette"></div><div class="color-input-wrapper"><input type="color" id="borderColor" value="#FFD700" oninput="drawCanvas()"></div></div></div>
            <div class="section" id="section-text"><div class="section-header" onclick="toggleSection('section-text')"><div class="section-title"><i class="fas fa-font"></i> <span data-lang="section_text">í…ìŠ¤íŠ¸ í¸ì§‘</span></div><i class="fas fa-chevron-down section-toggle-icon"></i></div><div class="section-content"><div class="font-manager"><label style="color:#3ea6ff; margin-bottom:8px;"><i class="fas fa-upload"></i> <span data-lang="label_font_upload">ë‚´ ì»´í“¨í„° í°íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</span></label><input type="file" id="fontFileInput" class="hidden-file-input" onchange="handleFontUpload(this)"><label for="fontFileInput" class="btn btn-secondary"><i class="fas fa-file-import"></i> <span data-lang="btn_font_select">í°íŠ¸ íŒŒì¼ ì„ íƒ (.ttf/.otf)</span></label><div style="margin-top:10px; border-top:1px dashed #444; padding-top:10px;"><label data-lang="label_font_manual">ë˜ëŠ” ì„¤ì¹˜ëœ í°íŠ¸ ì´ë¦„ ì§ì ‘ ì…ë ¥</label><div style="display:flex; gap:5px;"><input type="text" id="manualFontInput" placeholder="ì˜ˆ: NanumGothic" style="margin-bottom:0;"><button class="btn btn-secondary" style="width:50px; margin-bottom:0;" onclick="addManualFont()"><span data-lang="btn_add">ì¶”ê°€</span></button></div></div><p style="font-size:11px; color:#888; margin-top:5px;" data-lang="desc_iphone">* ì•„ì´í°ì€ 'íŒŒì¼' ì•±ì— ì €ì¥ëœ í°íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p></div><button class="btn btn-primary" onclick="addTextLayer()"><i class="fas fa-plus"></i> <span data-lang="btn_add_text">í…ìŠ¤íŠ¸ ì¶”ê°€í•˜ê¸°</span></button><div id="textLayersContainer"></div></div></div>
        </div>

        <!-- 2. ì¤‘ì•™ ìº”ë²„ìŠ¤ ì˜ì—­ -->
        <div class="center-panel-wrapper">
            <div class="quick-menu">
                <div class="quick-btn active" onclick="jumpToSection('section-bg', this)"><i class="fas fa-image"></i> <span data-lang="menu_bg">ë°°ê²½</span></div>
                <div class="quick-btn" onclick="jumpToSection('section-layout', this)"><i class="fas fa-th-large"></i> <span data-lang="menu_layout">ë°°ì¹˜</span></div>
                <div class="quick-btn" onclick="jumpToSection('section-effect', this)"><i class="fas fa-magic"></i> <span data-lang="menu_effect">íš¨ê³¼</span></div>
                <div class="quick-btn" onclick="jumpToSection('section-text', this)"><i class="fas fa-font"></i> <span data-lang="menu_text">í…ìŠ¤íŠ¸</span></div>
            </div>

            <div class="canvas-scroll-area">
                <div id="canvas-wrapper"><canvas id="mainCanvas"></canvas></div>
                <div class="canvas-actions">
                    <div style="display: flex; gap: 15px; width: 100%; justify-content: space-between; font-size: 12px; color: #888;"><span><i class="fas fa-mouse-pointer"></i> <b data-lang="tip_drag">Tip: ë“œë˜ê·¸ ì‹œ ê·¸ë¦¬ë“œì— ìì„ì²˜ëŸ¼ ë¶™ìŠµë‹ˆë‹¤.</b></span><span><i class="fas fa-file-image"></i> 1280x720 (Max 2MB)</span></div>
                    
                    <button class="btn btn-success" id="saveBtn" onclick="downloadImage()"><i class="fas fa-download"></i> <span data-lang="btn_save">ì¸ë„¤ì¼ ì €ì¥í•˜ê¸° (ìë™ ìµœì í™”)</span></button>

                    <!-- â˜… ì»¤í”¼ ì˜ê¸° ì˜ì—­ (ì¤‘ì•™ í•˜ë‹¨ìœ¼ë¡œ ì´ë™) -->
                    <div class="donation-area">
                        <h4><i class="fas fa-coffee"></i> <span data-lang="donation_title">[ê°œë°œìì—ê²Œ ì»¤í”¼ ì˜ê¸°]</span></h4>
                        <div class="donation-link">
                            <div class="qr-wrapper" id="qrWrapper" style="display:none;"><img src="" alt="ì¹´ì¹´ì˜¤í˜ì´ QR" class="qr-img"></div>
                            <div id="qr-error" style="color:#888; font-size:12px; text-align:center;"><i class="fas fa-exclamation-circle"></i> <span data-lang="qr_desc">ì•„ë˜ 'ë°°í¬ìš© íŒŒì¼ ë§Œë“¤ê¸°'ì—ì„œ QR ì½”ë“œë¥¼ ë“±ë¡í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” (ìœ íŠœë¸Œ) -->
        <div class="right-sidebar">
            <div class="youtube-card" id="ytCard">
                <div class="yt-header"><i class="fab fa-youtube"></i> NEW VIDEO</div>
                <div class="video-container" id="videoContainer" onclick="playVideo()">
                    <div class="play-button"><i class="fas fa-play"></i></div>
                    <div id="ytPlaceholder" style="position:absolute; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center; background:#000;">
                        <i class="fas fa-spinner fa-spin" style="color:#666;"></i>
                    </div>
                </div>
                <div class="video-info">
                    <div class="video-title" id="videoTitle">Loading...</div>
                    <div class="video-date" id="videoDate"></div>
                </div>
            </div>
        </div>
      </div>
    </div>

    <script>
      const canvas = document.getElementById('mainCanvas');
      const ctx = canvas.getContext('2d');
      
      var youtubeChannelID = "UC0Bt7KnLHp11JHqgFdsX7SQ"; 
      var currentVideoId = ""; 

      let currentLang = 'ko';
      let bgLayer = { img: null, x: 0, y: 0, w: 0, h: 0, locked: true, aspectRatio: 1 };
      let isDragging = false, dragTarget = null, dragIndex = -1, startX, startY, startBgX, startBgY, activeGrid = 0, textLayers = [];
      const colorPresets = ['#FFFFFF', '#000000', '#FF0000', '#FFD700', '#00FF00', '#00FFFF', '#FF00FF', '#FF5722', '#2196F3', '#9C27B0', '#F48FB1', '#FFF59D'];
      let customColors = ['#333333', '#555555', '#777777', '#999999', '#AAAAAA'];
      let availableFonts = [{ name: 'Impact', value: 'Impact' }, { name: 'ê³ ë”• (ê¸°ë³¸)', value: 'sans-serif' }, { name: 'ëª…ì¡° (ì§„ì§€)', value: 'serif' }, { name: 'Verdana (ê¹”ë”)', value: 'Verdana' }, { name: 'Comic Sans (ì†ê¸€ì”¨)', value: 'Comic Sans MS' }, { name: 'Arial Black', value: 'Arial Black' }];
      
      /* ë‹¤êµ­ì–´ ë°ì´í„° */
      const translations = {
          ko: {
              title: "ë”¸ê¹ ìœ íŠœë¸Œ ì¸ë„¤ì¼ ë©”ì´ì»¤ V31", subtitle: "[ ë¬´ë‹¨ ìˆ˜ì •, ë³µì œ, ì¬ë°°í¬ ê¸ˆì§€ ]",
              section_bg: "ë°°ê²½ & ì•ˆì „ ì˜ì—­", btn_load_img: "ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°", label_lock: "ì´ë¯¸ì§€ ì ê¸ˆ (Lock)", label_size: "í¬ê¸° ì¡°ì ˆ (Width / Height)", label_ratio: "ë¹„ìœ¨ ê³ ì • (Aspect Ratio)", label_zoom: "ğŸš€ ì „ì²´ í¬ê¸° ì¡°ì ˆ (Zoom)", label_pos: "ìœ„ì¹˜ ì´ë™ (X / Y)", btn_reset: "ì´ë¯¸ì§€ í¬ê¸°/ìœ„ì¹˜ ì´ˆê¸°í™”", label_safezone: "ì‹œê°„ í‘œì‹œ (Safe Zone)", label_music: "ìŒí‘œ ì•„ì´ì½˜ (ë®¤ì§ë¹„ë””ì˜¤)", label_grid3: "3ë¶„í•  ê·¸ë¦¬ë“œ (ìì„)", label_grid6: "6ë¶„í•  ê·¸ë¦¬ë“œ (ìì„)",
              section_layout: "í´ë¦­ ë¶€ë¥´ëŠ” 6ê°€ì§€ ë°°ì¹˜", preset_center: "ì¤‘ì•™ ì´ˆëŒ€í˜•", preset_hook: "ì¢Œì¸¡ í›…(Hook)", preset_split: "ì¢Œìš° ë¶„í• ", preset_bottom: "í•˜ë‹¨ ìë§‰í˜•", preset_badge: "ì¢Œìƒë‹¨ ë±ƒì§€", preset_diagonal: "ëŒ€ê°ì„  ë°°ì¹˜",
              section_effect: "ë””ìì¸ íš¨ê³¼", label_shadow: "ğŸ¬ ì‹œë„¤ë§ˆí‹± ê·¸ë¦¼ì (í•˜ë‹¨)", label_border: "ğŸ–¼ï¸ ì¸ë„¤ì¼ í…Œë‘ë¦¬", label_thickness: "ë‘ê»˜", label_radius: "ë¼ìš´ë”©", label_border_color: "í…Œë‘ë¦¬ ìƒ‰ìƒ",
              section_text: "í…ìŠ¤íŠ¸ í¸ì§‘", label_font_upload: "ë‚´ ì»´í“¨í„° í°íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°", btn_font_select: "í°íŠ¸ íŒŒì¼ ì„ íƒ (.ttf/.otf)", label_font_manual: "ë˜ëŠ” ì„¤ì¹˜ëœ í°íŠ¸ ì´ë¦„ ì§ì ‘ ì…ë ¥", btn_add: "ì¶”ê°€", desc_iphone: "* ì•„ì´í°ì€ 'íŒŒì¼' ì•±ì— ì €ì¥ëœ í°íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", btn_add_text: "í…ìŠ¤íŠ¸ ì¶”ê°€í•˜ê¸°",
              menu_bg: "ë°°ê²½", menu_layout: "ë°°ì¹˜", menu_effect: "íš¨ê³¼", menu_text: "í…ìŠ¤íŠ¸",
              tip_drag: "Tip: ë“œë˜ê·¸ ì‹œ ê·¸ë¦¬ë“œì— ìì„ì²˜ëŸ¼ ë¶™ìŠµë‹ˆë‹¤.", btn_save: "ì¸ë„¤ì¼ ì €ì¥í•˜ê¸° (ìë™ ìµœì í™”)", donation_title: "[ê°œë°œìì—ê²Œ ì»¤í”¼ ì˜ê¸°]", qr_desc: "ì™¼ìª½ ìƒë‹¨ 'ë°°í¬ íŒŒì¼ ìƒì„±ê¸°'ì—ì„œ QR ì½”ë“œë¥¼ ë“±ë¡í•˜ì„¸ìš”.", owner_title: "ğŸ‘‘ ë°°í¬ìš© íŒŒì¼ ë§Œë“¤ê¸° (ì£¼ì¸ì¥ ì „ìš©)", owner_desc: "ì„¤ì • ì €ì¥ ë° ë°°í¬ íŒŒì¼ ìƒì„±", btn_dist: "ğŸ“‚ QR ì½”ë“œ ì´ë¯¸ì§€ ì„ íƒ & ì €ì¥",
              label_content: "ë‚´ìš©", label_font: "ê¸€ê¼´", label_layer_size: "í¬ê¸°", label_style: "ìŠ¤íƒ€ì¼", label_text_color: "í…ìŠ¤íŠ¸ ìƒ‰ìƒ", btn_save_color: "ìƒ‰ ì €ì¥", label_stroke: "ê¸€ì ì™¸ê³½ì„ ", label_layer_thickness: "ë‘ê»˜", label_stroke_color: "ìƒ‰ìƒ", label_bgbox: "ë°°ê²½ ë°•ìŠ¤", label_bgcolor: "ë°°ê²½ ìƒ‰ìƒ", label_padding: "ì—¬ë°±", label_bg_radius: "ë‘¥ê¸€ê¸°", label_bg_border: "ë°°ê²½ í…Œë‘ë¦¬", label_bg_border_color: "í…Œë‘ë¦¬ ìƒ‰ìƒ", label_pos_layer: "ìœ„ì¹˜"
          },
          en: {
              title: "Click Youtube Thumbnail Maker V31", subtitle: "[ No Unauthorized Mod/Copy/Distribute ]",
              section_bg: "Background & Safe Zone", btn_load_img: "Load Image", label_lock: "Lock Image", label_size: "Resize (W / H)", label_ratio: "Aspect Ratio", label_zoom: "ğŸš€ Zoom", label_pos: "Position (X / Y)", btn_reset: "Reset Image", label_safezone: "Time (Safe Zone)", label_music: "Music Icon", label_grid3: "Grid 3x3 (Snap)", label_grid6: "Grid 6x6 (Snap)",
              section_layout: "6 Viral Layouts", preset_center: "Center Big", preset_hook: "Left Hook", preset_split: "Split Contrast", preset_bottom: "Bottom Story", preset_badge: "Corner Badge", preset_diagonal: "Diagonal",
              section_effect: "Effects", label_shadow: "ğŸ¬ Cinematic Shadow", label_border: "ğŸ–¼ï¸ Border", label_thickness: "Width", label_radius: "Radius", label_border_color: "Border Color",
              section_text: "Text Edit", label_font_upload: "Upload Font", btn_font_select: "Select Font File", label_font_manual: "Or Input Font Name", btn_add: "Add", desc_iphone: "* iPhone: Select from 'Files' app.", btn_add_text: "Add Text",
              menu_bg: "BG", menu_layout: "Layout", menu_effect: "Effect", menu_text: "Text",
              tip_drag: "Tip: Draggable items snap to grid.", btn_save: "Save Thumbnail (Optimized)", donation_title: "[Buy me a coffee]", qr_desc: "Upload QR code via 'Distributor Tool' on top left.", owner_title: "ğŸ‘‘ Create Distributable File (Admin)", owner_desc: "Save Settings & HTML", btn_dist: "Select QR Image & Save",
              label_content: "Content", label_font: "Font", label_layer_size: "Size", label_style: "Style", label_text_color: "Text Color", btn_save_color: "Save Color", label_stroke: "Stroke", label_layer_thickness: "Width", label_stroke_color: "Color", label_bgbox: "Background Box", label_bgcolor: "BG Color", label_padding: "Padding", label_bg_radius: "Radius", label_bg_border: "Box Border", label_bg_border_color: "Border Color", label_pos_layer: "Position"
          },
          ja: {
              title: "ã‚¯ãƒªãƒƒã‚¯ï¼YouTubeã‚µãƒ ãƒãƒ¡ãƒ¼ã‚«ãƒ¼ V31", subtitle: "[ ç„¡æ–­ä¿®æ­£ãƒ»è¤‡è£½ãƒ»å†é…å¸ƒç¦æ­¢ ]",
              section_bg: "èƒŒæ™¯ï¼†ã‚»ãƒ¼ãƒ•ã‚¾ãƒ¼ãƒ³", btn_load_img: "ç”»åƒã‚’èª­ã¿è¾¼ã‚€", label_lock: "ç”»åƒã‚’ãƒ­ãƒƒã‚¯", label_size: "ã‚µã‚¤ã‚ºèª¿æ•´ (W / H)", label_ratio: "æ¯”ç‡ã‚’å›ºå®š", label_zoom: "ğŸš€ ã‚ºãƒ¼ãƒ ", label_pos: "ä½ç½®ç§»å‹• (X / Y)", btn_reset: "ç”»åƒãƒªã‚»ãƒƒãƒˆ", label_safezone: "æ™‚é–“è¡¨ç¤º (ã‚»ãƒ¼ãƒ•ã‚¾ãƒ¼ãƒ³)", label_music: "éŸ³ç¬¦ã‚¢ã‚¤ã‚³ãƒ³", label_grid3: "3åˆ†å‰²ã‚°ãƒªãƒƒãƒ‰ (ç£çŸ³)", label_grid6: "6åˆ†å‰²ã‚°ãƒªãƒƒãƒ‰ (ç£çŸ³)",
              section_layout: "ã‚¯ãƒªãƒƒã‚¯ã‚’å‘¼ã¶6ã¤ã®é…ç½®", preset_center: "ä¸­å¤®ç‰¹å¤§", preset_hook: "å·¦ãƒ•ãƒƒã‚¯", preset_split: "å·¦å³åˆ†å‰²", preset_bottom: "ä¸‹éƒ¨å­—å¹•", preset_badge: "å·¦ä¸Šãƒãƒƒã‚¸", preset_diagonal: "å¯¾è§’ç·šé…ç½®",
              section_effect: "ãƒ‡ã‚¶ã‚¤ãƒ³åŠ¹æœ", label_shadow: "ğŸ¬ æ˜ ç”»é¢¨ã‚·ãƒ£ãƒ‰ã‚¦", label_border: "ğŸ–¼ï¸ æ ç·š", label_thickness: "å¤ªã•", label_radius: "è§’ä¸¸", label_border_color: "æ ç·šã®è‰²",
              section_text: "ãƒ†ã‚­ã‚¹ãƒˆç·¨é›†", label_font_upload: "ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿", btn_font_select: "ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ", label_font_manual: "ã¾ãŸã¯ãƒ•ã‚©ãƒ³ãƒˆåå…¥åŠ›", btn_add: "è¿½åŠ ", desc_iphone: "* iPhoneã¯ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚¢ãƒ—ãƒªã‹ã‚‰é¸æŠã€‚", btn_add_text: "ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ ",
              menu_bg: "èƒŒæ™¯", menu_layout: "é…ç½®", menu_effect: "åŠ¹æœ", menu_text: "æ–‡å­—",
              tip_drag: "Tip: ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚°ãƒªãƒƒãƒ‰ã«å¸ç€ã€‚", btn_save: "ä¿å­˜ (æœ€é©åŒ–)", donation_title: "[é–‹ç™ºè€…ã«ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’]", qr_desc: "å·¦ä¸Šã®ç®¡ç†è€…ãƒ„ãƒ¼ãƒ«ã§QRã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚", owner_title: "ğŸ‘‘ é…å¸ƒç”¨ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ (ç®¡ç†è€…)", owner_desc: "è¨­å®šä¿å­˜ï¼†HTMLç”Ÿæˆ", btn_dist: "QRç”»åƒé¸æŠï¼†ä¿å­˜",
              label_content: "å†…å®¹", label_font: "ãƒ•ã‚©ãƒ³ãƒˆ", label_layer_size: "ã‚µã‚¤ã‚º", label_style: "ã‚¹ã‚¿ã‚¤ãƒ«", label_text_color: "æ–‡å­—è‰²", btn_save_color: "è‰²ä¿å­˜", label_stroke: "ç¸å–ã‚Š", label_layer_thickness: "å¤ªã•", label_stroke_color: "è‰²", label_bgbox: "èƒŒæ™¯ãƒœãƒƒã‚¯ã‚¹", label_bgcolor: "èƒŒæ™¯è‰²", label_padding: "ä½™ç™½", label_bg_radius: "è§’ä¸¸", label_bg_border: "æ ç·š", label_bg_border_color: "æ è‰²", label_pos_layer: "ä½ç½®"
          },
          zh: {
              title: "ç‚¹å‡» YouTube ç¼©ç•¥å›¾åˆ¶ä½œå·¥å…· V31", subtitle: "[ ç¦æ­¢æ“…è‡ªä¿®æ”¹ã€å¤åˆ¶ã€å†åˆ†å‘ ]",
              section_bg: "èƒŒæ™¯ä¸å®‰å…¨åŒºåŸŸ", btn_load_img: "åŠ è½½å›¾ç‰‡", label_lock: "é”å®šå›¾ç‰‡", label_size: "è°ƒæ•´å¤§å° (W / H)", label_ratio: "é”å®šæ¯”ä¾‹", label_zoom: "ğŸš€ ç¼©æ”¾", label_pos: "ç§»åŠ¨ä½ç½® (X / Y)", btn_reset: "é‡ç½®å›¾ç‰‡", label_safezone: "æ—¶é—´æ˜¾ç¤º (å®‰å…¨åŒº)", label_music: "éŸ³ç¬¦å›¾æ ‡", label_grid3: "3åˆ†ç½‘æ ¼ (å¸é™„)", label_grid6: "6åˆ†ç½‘æ ¼ (å¸é™„)",
              section_layout: "6ç§çƒ­é—¨å¸ƒå±€", preset_center: "ä¸­å¤®è¶…å¤§", preset_hook: "å·¦ä¾§é’©å­", preset_split: "å·¦å³åˆ†å‰²", preset_bottom: "åº•éƒ¨å­—å¹•", preset_badge: "å·¦ä¸Šè§’å¾½ç« ", preset_diagonal: "å¯¹è§’çº¿å¸ƒå±€",
              section_effect: "è®¾è®¡æ•ˆæœ", label_shadow: "ğŸ¬ ç”µå½±æ„Ÿé˜´å½±", label_border: "ğŸ–¼ï¸ è¾¹æ¡†", label_thickness: "å®½åº¦", label_radius: "åœ†è§’", label_border_color: "è¾¹æ¡†é¢œè‰²",
              section_text: "æ–‡æœ¬ç¼–è¾‘", label_font_upload: "åŠ è½½æœ¬åœ°å­—ä½“", btn_font_select: "é€‰æ‹©å­—ä½“æ–‡ä»¶", label_font_manual: "æˆ–è¾“å…¥å·²å®‰è£…å­—ä½“åç§°", btn_add: "æ·»åŠ ", desc_iphone: "* iPhone è¯·ä»â€œæ–‡ä»¶â€Appé€‰æ‹©ã€‚", btn_add_text: "æ·»åŠ æ–‡æœ¬",
              menu_bg: "èƒŒæ™¯", menu_layout: "å¸ƒå±€", menu_effect: "æ•ˆæœ", menu_text: "æ–‡æœ¬",
              tip_drag: "æç¤º: æ‹–åŠ¨æ—¶å¸é™„ç½‘æ ¼ã€‚", btn_save: "ä¿å­˜ç¼©ç•¥å›¾ (ä¼˜åŒ–)", donation_title: "[è¯·å¼€å‘è€…å–å’–å•¡]", qr_desc: "è¯·åœ¨å·¦ä¸Šè§’å·¥å…·ä¸­ä¸Šä¼ äºŒç»´ç ã€‚", owner_title: "ğŸ‘‘ åˆ¶ä½œå‘å¸ƒæ–‡ä»¶ (ç®¡ç†å‘˜)", owner_desc: "ä¿å­˜è®¾ç½®å¹¶ç”ŸæˆHTML", btn_dist: "é€‰æ‹©äºŒç»´ç å›¾ç‰‡å¹¶ä¿å­˜",
              label_content: "å†…å®¹", label_font: "å­—ä½“", label_layer_size: "å¤§å°", label_style: "æ ·å¼", label_text_color: "æ–‡æœ¬é¢œè‰²", btn_save_color: "ä¿å­˜é¢œè‰²", label_stroke: "æè¾¹", label_layer_thickness: "å®½åº¦", label_stroke_color: "é¢œè‰²", label_bgbox: "èƒŒæ™¯æ¡†", label_bgcolor: "èƒŒæ™¯é¢œè‰²", label_padding: "å†…è¾¹è·", label_bg_radius: "åœ†è§’", label_bg_border: "æ¡†è¾¹æ¡†", label_bg_border_color: "è¾¹æ¡†é¢œè‰²", label_pos_layer: "ä½ç½®"
          }
      };

      canvas.width = 1280; canvas.height = 720;
      
      function init() {
        createPaletteUI('borderPalette', 'borderColor');
        drawCanvas();
        renderTextLayersUI();
        setupCanvasEvents();
        
        if(youtubeChannelID && youtubeChannelID !== "") {
            fetchLatestVideo(youtubeChannelID);
            document.getElementById('adminChannelId').value = youtubeChannelID;
        }
      }
      
      // â˜… ìœ íŠœë¸Œ ì˜ìƒ ë¡œì§
      function fetchLatestVideo(channelId) {
          const rssUrl = `https://www.youtube.com/feeds/videos.xml?channel_id=${channelId}`;
          const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
          
          fetch(apiUrl)
          .then(response => response.json())
          .then(data => {
              if(data.status === 'ok' && data.items.length > 0) {
                  const latestVideo = data.items[0];
                  currentVideoId = latestVideo.link.split('v=')[1];
                  const title = latestVideo.title;
                  const date = latestVideo.pubDate.split(' ')[0];
                  
                  // ì¸ë„¤ì¼ í‘œì‹œ ë° ë¡œë”© ìˆ¨ê¹€
                  document.getElementById('ytPlaceholder').style.display = 'none';
                  const container = document.getElementById('videoContainer');
                  
                  // ê³ í™”ì§ˆ ì‹œë„
                  const thumbUrl = `https://img.youtube.com/vi/${currentVideoId}/maxresdefault.jpg`;
                  
                  container.innerHTML = `
                      <img src="${thumbUrl}" alt="Thumbnail" onerror="this.src='https://img.youtube.com/vi/${currentVideoId}/hqdefault.jpg'">
                      <div class="play-button"><i class="fas fa-play"></i></div>
                  `;
                  
                  document.getElementById('videoTitle').innerText = title;
                  document.getElementById('videoDate').innerText = date;
                  
                  youtubeChannelID = channelId; 
              } else {
                  document.getElementById('videoTitle').innerText = "ì˜ìƒì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
              }
          })
          .catch(error => {
              console.error('Error:', error);
          });
      }

      function playVideo() {
          if(!currentVideoId) return;
          const container = document.getElementById('videoContainer');
          container.innerHTML = `<iframe src="https://www.youtube.com/embed/${currentVideoId}?autoplay=1&playsinline=1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
      }

      function changeLanguage(lang) {
          currentLang = lang;
          document.querySelectorAll('[data-lang]').forEach(el => {
              const key = el.getAttribute('data-lang');
              if(translations[lang][key]) el.innerHTML = translations[lang][key];
          });
          renderTextLayersUI();
      }

      // â˜… [ìˆ˜ì •] QR ì½”ë“œ ì¦‰ì‹œ ì ìš© ë° íŒŒì¼ ìƒì„± (ìƒˆë¡œê³ ì¹¨ ì œê±°)
      function makeSingleFile(input) {
          if(!input.files || !input.files[0]) return;
          const reader = new FileReader();
          reader.onload = function(e) {
              const base64Img = e.target.result; 
              
              // 1. í˜„ì¬ í™”ë©´ì— ì¦‰ì‹œ ì ìš© (ë¯¸ë¦¬ë³´ê¸°) - ì»¤í”¼ ì˜ì—­
              const qrImg = document.querySelector('.qr-img');
              if(qrImg) qrImg.src = base64Img;
              
              const qrWrapper = document.getElementById('qrWrapper');
              if(qrWrapper) qrWrapper.style.display = 'inline-block';
              
              const qrError = document.getElementById('qr-error');
              if(qrError) qrError.style.display = 'none';

              // 2. ë°°í¬ìš© HTML ìƒì„± (í˜„ì¬ í™”ë©´ ìƒíƒœ ë³µì œ í›„ ê°€ê³µ)
              // í˜„ì¬ ìƒíƒœì˜ HTML ë¬¸ìì—´ì„ ê°€ì ¸ì˜´ (ì´ë¯¸ì§€ srcê°€ ì—…ë°ì´íŠ¸ëœ ìƒíƒœì„)
              let currentHtml = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
              
              // ê°€ìƒ DOM ìƒì„±í•˜ì—¬ í¸ì§‘
              const parser = new DOMParser();
              const doc = parser.parseFromString(currentHtml, 'text/html');
              
              // ê´€ë¦¬ì ë„êµ¬ ì œê±° (ë°°í¬ íŒŒì¼ì—ì„œë§Œ)
              const adminTools = doc.getElementById('adminToolsPanel');
              if(adminTools) adminTools.remove();
              
              // ìœ íŠœë¸Œ ì±„ë„ ID ì˜êµ¬ ì €ì¥
              const currentChannelId = document.getElementById('adminChannelId').value.trim();
              let finalHtml = doc.documentElement.outerHTML;
              
               if(currentChannelId) {
                  finalHtml = finalHtml.replace(/var youtubeChannelID = ".*?";/, `var youtubeChannelID = "${currentChannelId}";`);
              }
              
              // ë‹¤ìš´ë¡œë“œ
              const blob = new Blob(["<!DOCTYPE html>\n" + finalHtml], {type: 'text/html'});
              const a = document.createElement('a');
              a.href = URL.createObjectURL(blob);
              a.download = 'ë”¸ê¹_ì¸ë„¤ì¼_ë©”ì´ì»¤.html';
              a.click();
              
              alert("âœ… í™”ë©´ì— QRì½”ë“œê°€ ì ìš©ë˜ì—ˆìœ¼ë©°,\në°°í¬ìš© íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œ ë˜ì—ˆìŠµë‹ˆë‹¤.");
          }
          reader.readAsDataURL(input.files[0]);
          input.value = ''; // ì…ë ¥ ì´ˆê¸°í™”
      }

      // ... (ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ì€ ê·¸ëŒ€ë¡œ ìœ ì§€) ...
      function toggleSection(id) { document.getElementById(id).classList.toggle('collapsed'); }
      function jumpToSection(id, btnElement) {
          document.querySelectorAll('.quick-btn').forEach(btn => btn.classList.remove('active'));
          btnElement.classList.add('active');
          const section = document.getElementById(id);
          section.classList.remove('collapsed');
          const panel = document.getElementById('mainControlPanel');
          if(window.innerWidth <= 900) { section.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
          else { panel.scrollTo({ top: section.offsetTop - panel.offsetTop, behavior: 'smooth' }); }
      }
      function handleImageUpload(input) {
        const reader = new FileReader();
        reader.onload = function(event){
            const img = new Image();
            img.onload = function(){ resetBgLogic(img); }
            img.src = event.target.result;
        }
        if(input.files[0]) reader.readAsDataURL(input.files[0]);
        input.value = null; 
      }
      function resetBgLogic(img) {
          const hRatio = canvas.width / img.width; const vRatio = canvas.height / img.height; const ratio = Math.max(hRatio, vRatio); 
          bgLayer.img = img; bgLayer.aspectRatio = img.width / img.height;
          bgLayer.w = img.width * ratio; bgLayer.h = img.height * ratio;
          bgLayer.x = (canvas.width - bgLayer.w) / 2; bgLayer.y = (canvas.height - bgLayer.h) / 2;
          bgLayer.locked = true; 
          document.getElementById('bgControlPanel').style.display = 'block';
          updateBgUI(); toggleScaleSlider(); drawCanvas();
      }
      function resetBgImage() { if(!bgLayer.img) return; resetBgLogic(bgLayer.img); }
      function updateBgUI() {
          document.getElementById('bgWidth').value = Math.round(bgLayer.w); document.getElementById('bgHeight').value = Math.round(bgLayer.h);
          document.getElementById('bgX').value = Math.round(bgLayer.x); document.getElementById('bgY').value = Math.round(bgLayer.y);
          document.getElementById('bgXSlider').value = Math.round(bgLayer.x); document.getElementById('bgYSlider').value = Math.round(bgLayer.y);
          document.getElementById('bgLock').checked = bgLayer.locked;
          const currentPercent = Math.round((bgLayer.w / canvas.width) * 100);
          document.getElementById('bgScaleSlider').value = currentPercent; document.getElementById('scaleValue').innerText = currentPercent + '%';
      }
      window.updateBgSize = function(type) {
          if(!bgLayer.img) return; const keepRatio = document.getElementById('bgRatio').checked;
          if(type === 'w') { bgLayer.w = parseFloat(document.getElementById('bgWidth').value); if(keepRatio) bgLayer.h = bgLayer.w / bgLayer.aspectRatio; } 
          else { bgLayer.h = parseFloat(document.getElementById('bgHeight').value); if(keepRatio) bgLayer.w = bgLayer.h * bgLayer.aspectRatio; }
          updateBgUI(); drawCanvas();
      }
      window.updateBgScale = function(val) {
          if(!bgLayer.img) return; const percent = parseInt(val);
          bgLayer.w = (canvas.width * percent) / 100; bgLayer.h = bgLayer.w / bgLayer.aspectRatio;
          updateBgUI(); drawCanvas();
      }
      window.updateBgPos = function(source) {
          if(!bgLayer.img) return;
          if(source === 'input') { bgLayer.x = parseFloat(document.getElementById('bgX').value); bgLayer.y = parseFloat(document.getElementById('bgY').value); } 
          else { bgLayer.x = parseFloat(document.getElementById('bgXSlider').value); bgLayer.y = parseFloat(document.getElementById('bgYSlider').value); }
          updateBgUI(); drawCanvas();
      }
      window.updateBgLock = function() { bgLayer.locked = document.getElementById('bgLock').checked; }
      window.toggleScaleSlider = function() {
          const isRatioLocked = document.getElementById('bgRatio').checked; const sliderArea = document.getElementById('scaleSliderArea');
          if(isRatioLocked && bgLayer.img) {
              sliderArea.style.display = 'block'; const currentPercent = Math.round((bgLayer.w / canvas.width) * 100);
              document.getElementById('bgScaleSlider').value = currentPercent; document.getElementById('scaleValue').innerText = currentPercent + '%';
          } else { sliderArea.style.display = 'none'; }
      }
      function drawCanvas(isExporting = false) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if (bgLayer.img) { ctx.drawImage(bgLayer.img, bgLayer.x, bgLayer.y, bgLayer.w, bgLayer.h); } 
        else { if(!isExporting) drawPlaceholderLines(); else { ctx.fillStyle = "#111"; ctx.fillRect(0,0,canvas.width,canvas.height); } }
        if (document.getElementById('checkGradient').checked) {
            const intensity = document.getElementById('gradIntensity').value / 100; const gradient = ctx.createLinearGradient(0, canvas.height * 0.4, 0, canvas.height);
            gradient.addColorStop(0, "rgba(0,0,0,0)"); gradient.addColorStop(1, `rgba(0,0,0,${intensity})`); ctx.fillStyle = gradient; ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        textLayers.forEach(layer => {
            const x = (canvas.width * layer.posX) / 100; const y = (canvas.height * layer.posY) / 100;
            const fontStyle = layer.isItalic ? 'italic' : ''; const fontWeight = layer.isBold ? 'bold' : 'normal';
            ctx.font = `${fontStyle} ${fontWeight} ${layer.fontSize}px "${layer.fontFamily}"`;
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            if (layer.useBg) {
                const metrics = ctx.measureText(layer.text); const textWidth = metrics.width; const boxHeight = layer.fontSize + (layer.bgPadding * 2); const boxWidth = textWidth + (layer.bgPadding * 2) + 20; 
                ctx.save(); ctx.beginPath(); ctx.roundRect(x - boxWidth / 2, y - boxHeight / 2, boxWidth, boxHeight, layer.bgRadius); ctx.fillStyle = layer.bgColor; ctx.fill();
                if (layer.bgBorderWidth > 0) { ctx.lineWidth = layer.bgBorderWidth; ctx.strokeStyle = layer.bgBorderColor; ctx.stroke(); } ctx.restore();
            }
            ctx.lineJoin = 'round';
            if (layer.useStroke) { ctx.lineWidth = layer.strokeWidth; ctx.strokeStyle = layer.strokeColor; ctx.strokeText(layer.text, x, y); }
            if (layer.shadow) { ctx.shadowColor = "rgba(0,0,0,0.6)"; ctx.shadowBlur = 15; ctx.shadowOffsetX = 5; ctx.shadowOffsetY = 5; }
            ctx.fillStyle = layer.color; ctx.fillText(layer.text, x, y);
            ctx.shadowColor = "transparent"; ctx.shadowBlur = 0; ctx.shadowOffsetX = 0; ctx.shadowOffsetY = 0;
            if (layer.isUnderline) {
                const metrics = ctx.measureText(layer.text); const width = metrics.width; const lineY = y + layer.fontSize * 0.55; 
                ctx.beginPath(); ctx.strokeStyle = layer.color; ctx.lineWidth = layer.fontSize * 0.08; ctx.moveTo(x - width/2, lineY); ctx.lineTo(x + width/2, lineY); ctx.stroke();
            }
        });
        if (document.getElementById('checkBorder').checked) {
            const borderWidth = parseInt(document.getElementById('borderWidth').value); const borderRadius = parseInt(document.getElementById('borderRadius').value); const borderColor = document.getElementById('borderColor').value;
            ctx.strokeStyle = borderColor; ctx.lineWidth = borderWidth; const halfW = borderWidth / 2;
            ctx.beginPath(); ctx.roundRect(halfW, halfW, canvas.width - borderWidth, canvas.height - borderWidth, borderRadius); ctx.stroke();
        }
        const r = 30; 
        if (document.getElementById('checkSafeZone').checked && !isExporting) {
            ctx.fillStyle = "#000000"; ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(r, 0); ctx.arcTo(0, 0, 0, r, r); ctx.lineTo(0, 0); ctx.fill();
            ctx.beginPath(); ctx.moveTo(canvas.width, 0); ctx.lineTo(canvas.width-r, 0); ctx.arcTo(canvas.width, 0, canvas.width, r, r); ctx.lineTo(canvas.width, 0); ctx.fill();
            ctx.beginPath(); ctx.moveTo(canvas.width, canvas.height); ctx.lineTo(canvas.width-r, canvas.height); ctx.arcTo(canvas.width, canvas.height, canvas.width, canvas.height-r, r); ctx.lineTo(canvas.width, canvas.height); ctx.fill();
            ctx.beginPath(); ctx.moveTo(0, canvas.height); ctx.lineTo(r, canvas.height); ctx.arcTo(0, canvas.height, 0, canvas.height-r, r); ctx.lineTo(0, canvas.height); ctx.fill();
        }
        if (!isExporting) { drawGuides(); drawTimestamp(); }
      }
      function setupCanvasEvents() {
        canvas.addEventListener('mousedown', (e) => { e.preventDefault(); startInput(getMousePos(e)); });
        canvas.addEventListener('mousemove', (e) => { const pos = getMousePos(e); if(isDragging) { e.preventDefault(); moveInput(pos); } else updateCursor(pos); });
        canvas.addEventListener('mouseup', endInput); canvas.addEventListener('mouseout', endInput);
        canvas.addEventListener('touchstart', (e) => { const pos = getTouchPos(canvas, e); if(isHitText(pos) || (!bgLayer.locked && bgLayer.img)) { if(e.cancelable) e.preventDefault(); startInput(pos); } }, {passive: false});
        canvas.addEventListener('touchmove', (e) => { if(isDragging) { if(e.cancelable) e.preventDefault(); moveInput(getTouchPos(canvas, e)); } }, {passive: false});
        canvas.addEventListener('touchend', endInput);
      }
      function startInput(pos) {
          for (let i = textLayers.length - 1; i >= 0; i--) { if (isHitTextLayer(textLayers[i], pos)) { isDragging = true; dragTarget = 'text'; dragIndex = i; if(document.getElementById('section-text').classList.contains('collapsed')) { jumpToSection('section-text', document.querySelectorAll('.quick-btn')[3]); } return; } }
          if(bgLayer.img && !bgLayer.locked) { isDragging = true; dragTarget = 'bg'; startX = pos.x; startY = pos.y; startBgX = bgLayer.x; startBgY = bgLayer.y; }
      }
      function moveInput(pos) {
          if (dragTarget === 'text') { const layer = textLayers[dragIndex]; let tempX = (pos.x / canvas.width) * 100; let tempY = (pos.y / canvas.height) * 100; tempX = Math.max(0, Math.min(100, tempX)); tempY = Math.max(0, Math.min(100, tempY)); layer.posX = snapToGrid(tempX, activeGrid); layer.posY = snapToGrid(tempY, activeGrid); drawCanvas(); } 
          else if (dragTarget === 'bg') { bgLayer.x = startBgX + (pos.x - startX); bgLayer.y = startBgY + (pos.y - startY); updateBgUI(); drawCanvas(); }
      }
      function endInput() { if(isDragging) { isDragging = false; dragTarget = null; dragIndex = -1; renderTextLayersUI(); } }
      function isHitText(pos) { for (let i = textLayers.length - 1; i >= 0; i--) { if (isHitTextLayer(textLayers[i], pos)) return true; } return false; }
      function isHitTextLayer(layer, pos) {
          const x = (canvas.width * layer.posX) / 100; const y = (canvas.height * layer.posY) / 100; const padding = layer.useBg ? layer.bgPadding + 20 : 15;
          ctx.font = `${layer.isItalic?'italic':''} ${layer.isBold?'bold':'normal'} ${layer.fontSize}px "${layer.fontFamily}"`; const metrics = ctx.measureText(layer.text);
          return (pos.x >= x - metrics.width/2 - padding && pos.x <= x + metrics.width/2 + padding && pos.y >= y - layer.fontSize/2 - padding && pos.y <= y + layer.fontSize/2 + padding);
      }
      function updateCursor(pos) { let hit = false; for (let i = textLayers.length - 1; i >= 0; i--) { if (isHitTextLayer(textLayers[i], pos)) { hit = true; break; } } if(!hit && bgLayer.img && !bgLayer.locked) { canvas.style.cursor = 'all-scroll'; } else { canvas.style.cursor = hit ? 'move' : 'default'; } }
      function getMousePos(evt) { const rect = canvas.getBoundingClientRect(); return { x: (evt.clientX - rect.left) * (canvas.width / rect.width), y: (evt.clientY - rect.top) * (canvas.height / rect.height) }; }
      function getTouchPos(canvasDom, touchEvent) { var rect = canvasDom.getBoundingClientRect(); var touch = touchEvent.touches[0] || touchEvent.changedTouches[0]; return { x: (touch.clientX - rect.left) * (canvasDom.width / rect.width), y: (touch.clientY - rect.top) * (canvasDom.height / rect.height) }; }
      function drawPlaceholderLines() { ctx.fillStyle = "#181818"; ctx.fillRect(0, 0, canvas.width, canvas.height); ctx.strokeStyle = "#222"; ctx.lineWidth = 1; for(let i=0; i<canvas.width; i+=40) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); } for(let i=0; i<canvas.height; i+=40) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); ctx.stroke(); } if(!bgLayer.img) { ctx.font = "bold 40px 'Segoe UI', sans-serif"; ctx.fillStyle = "#555"; ctx.textAlign = "center"; ctx.fillText("ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”", canvas.width/2, canvas.height/2); } }
      function drawGuides() {
          let showCenterX = false; let showCenterY = false; textLayers.forEach(layer => { if (Math.abs(layer.posX - 50) < 0.5) showCenterX = true; if (Math.abs(layer.posY - 50) < 0.5) showCenterY = true; });
          if (showCenterX || showCenterY) { ctx.setLineDash([10, 5]); ctx.lineWidth = 2; ctx.strokeStyle = "#00FFEA"; ctx.beginPath(); if (showCenterX) { ctx.moveTo(canvas.width/2, 0); ctx.lineTo(canvas.width/2, canvas.height); } if (showCenterY) { ctx.moveTo(0, canvas.height/2); ctx.lineTo(canvas.width, canvas.height/2); } ctx.stroke(); ctx.setLineDash([]); }
          if (activeGrid > 0) { const segments = activeGrid; const stepX = canvas.width / segments; const stepY = canvas.height / segments; ctx.strokeStyle = "#FFFF00"; ctx.lineWidth = 2; ctx.setLineDash([5, 5]); ctx.beginPath(); for (let i = 1; i < segments; i++) { ctx.moveTo(stepX * i, 0); ctx.lineTo(stepX * i, canvas.height); ctx.moveTo(0, stepY * i); ctx.lineTo(canvas.width, stepY * i); } ctx.stroke(); ctx.setLineDash([]); }
      }
      function drawTimestamp() {
          if (document.getElementById('checkSafeZone').checked) { const hasMusic = document.getElementById('checkMusicIcon').checked; const timeText = "4:05"; ctx.font = "bold 20px Roboto, Arial, sans-serif"; const musicIcon = "ğŸµ"; const textMetrics = ctx.measureText(timeText); let musicMetrics = { width: 0 }; if (hasMusic) { ctx.font = "20px Arial"; musicMetrics = ctx.measureText(musicIcon); ctx.font = "bold 20px Roboto, Arial, sans-serif"; } const paddingX = 8; const iconGap = hasMusic ? 5 : 0; const contentWidth = textMetrics.width + (hasMusic ? musicMetrics.width + iconGap : 0); const boxWidth = contentWidth + (paddingX * 2); const boxHeight = 36; const boxX = canvas.width - boxWidth - 8; const boxY = canvas.height - boxHeight - 8; ctx.fillStyle = "rgba(0, 0, 0, 0.85)"; ctx.beginPath(); ctx.roundRect(boxX, boxY, boxWidth, boxHeight, 6); ctx.fill(); ctx.fillStyle = "#ffffff"; ctx.textAlign = "left"; ctx.textBaseline = "middle"; let currentX = boxX + paddingX; const centerY = boxY + boxHeight/2 + 1; if (hasMusic) { ctx.font = "20px Arial"; ctx.fillText(musicIcon, currentX, centerY); currentX += musicMetrics.width + iconGap; } ctx.font = "bold 20px Roboto, Arial, sans-serif"; ctx.fillText(timeText, currentX, centerY); }
      }
      function addManualFont() { const input = document.getElementById('manualFontInput'); const fontName = input.value.trim(); if(!fontName) return; if(!availableFonts.find(f => f.value === fontName)) { availableFonts.push({ name: `ğŸ’» ${fontName}`, value: fontName }); } renderTextLayersUI(); if(textLayers.length > 0) { textLayers[textLayers.length - 1].fontFamily = fontName; renderTextLayersUI(); drawCanvas(); } input.value = ''; }
      function getFontOptionsHTML(selectedFont) { return availableFonts.map(font => `<option value="${font.value}" ${font.value === selectedFont ? 'selected' : ''}>${font.name}</option>`).join(''); }
      function saveCustomColor(inputId) { const color = document.getElementById(inputId).value; customColors.unshift(color); if (customColors.length > 5) customColors.pop(); renderTextLayersUI(); drawCanvas(); }
      function createPaletteUI(containerId, inputId) { const container = document.getElementById(containerId); container.innerHTML = ''; colorPresets.forEach(color => { const swatch = document.createElement('div'); swatch.className = 'color-swatch'; swatch.style.backgroundColor = color; swatch.onclick = () => { document.getElementById(inputId).value = color; drawCanvas(); }; container.appendChild(swatch); }); }
      function createTextPaletteHTML(layerIndex, targetProp, currentColor, inputId) {
        let html = '<div class="color-palette">'; colorPresets.forEach(color => { html += `<div class="color-swatch" style="background-color:${color};" onclick="updateLayer(${layerIndex}, '${targetProp}', {value: '${color}'})"></div>`; });
        html += '</div><div class="custom-palette-area"><div class="custom-label"><span>ë‚˜ë§Œì˜ ìƒ‰ (5ê°œ)</span></div><div class="color-palette">'; customColors.forEach(color => { html += `<div class="color-swatch" style="background-color:${color};" onclick="updateLayer(${layerIndex}, '${targetProp}', {value: '${color}'})"></div>`; });
        html += '</div></div>'; html += `<div class="color-input-wrapper"><input type="color" id="${inputId}" value="${currentColor}" oninput="updateLayer(${layerIndex}, '${targetProp}', this)"><button class="btn btn-secondary btn-small" onclick="saveCustomColor('${inputId}')"><i class="fas fa-save"></i> <span data-lang="btn_save_color">${translations[currentLang].btn_save_color}</span></button></div>`; return html;
      }
      function renderTextLayersUI() {
        const t = translations[currentLang]; const container = document.getElementById('textLayersContainer'); container.innerHTML = '';
        textLayers.forEach((layer, index) => {
          const div = document.createElement('div'); div.className = 'text-layer';
          const colorInputId = `textColorInput_${layer.id}`; const strokeColorInputId = `strokeColorInput_${layer.id}`; const bgColorInputId = `bgColorInput_${layer.id}`; const bgBorderColorInputId = `bgBorderColorInput_${layer.id}`;
          div.innerHTML = `
            <button class="remove-btn" onclick="removeLayer(${layer.id})"><i class="fas fa-times"></i></button>
            <label>${t.label_content}</label><input type="text" value="${layer.text}" oninput="updateLayer(${index}, 'text', this)">
            <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 8px; margin-bottom: 6px;"><div><label>${t.label_font}</label><select onchange="updateLayer(${index}, 'fontFamily', this)">${getFontOptionsHTML(layer.fontFamily)}</select></div><div><label>${t.label_layer_size}</label><input type="number" value="${layer.fontSize}" oninput="updateLayer(${index}, 'fontSize', this)"></div></div>
            <label>${t.label_style}</label><div class="style-group"><button class="style-btn ${layer.isBold ? 'active' : ''}" onclick="toggleStyle(${index}, 'isBold')"><i class="fas fa-bold"></i></button><button class="style-btn ${layer.isItalic ? 'active' : ''}" onclick="toggleStyle(${index}, 'isItalic')"><i class="fas fa-italic"></i></button><button class="style-btn ${layer.isUnderline ? 'active' : ''}" onclick="toggleStyle(${index}, 'isUnderline')"><i class="fas fa-underline"></i></button></div>
            <label>${t.label_text_color}</label>${createTextPaletteHTML(index, 'color', layer.color, colorInputId)}
            <div style="margin-top: 15px; border-top: 1px dashed #555; padding-top: 10px;"><div class="toggle-row"><span class="toggle-label"><i class="fas fa-pen-fancy"></i> ${t.label_stroke}</span><input type="checkbox" ${layer.useStroke ? 'checked' : ''} onchange="updateLayer(${index}, 'useStroke', {value: this.checked})"></div>
            ${layer.useStroke ? `<div class="sub-option-box"><label>${t.label_layer_thickness}</label><input type="range" min="0" max="40" value="${layer.strokeWidth}" oninput="updateLayer(${index}, 'strokeWidth', this)"><label>${t.label_stroke_color}</label>${createTextPaletteHTML(index, 'strokeColor', layer.strokeColor, strokeColorInputId)}</div>` : ''}</div>
            <div style="margin-top: 10px; border-top: 1px dashed #555; padding-top: 10px;"><div class="toggle-row"><span class="toggle-label" style="color:#FFD700;"><i class="fas fa-square"></i> ${t.label_bgbox}</span><input type="checkbox" ${layer.useBg ? 'checked' : ''} onchange="updateLayer(${index}, 'useBg', {value: this.checked})"></div>
            ${layer.useBg ? `<div class="sub-option-box"><label>${t.label_bgcolor}</label>${createTextPaletteHTML(index, 'bgColor', layer.bgColor, bgColorInputId)}<div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:5px;"><div><label>${t.label_padding}</label><input type="number" value="${layer.bgPadding}" oninput="updateLayer(${index}, 'bgPadding', this)"></div><div><label>${t.label_bg_radius}</label><input type="number" value="${layer.bgRadius}" oninput="updateLayer(${index}, 'bgRadius', this)"></div></div><label style="margin-top:5px;">${t.label_bg_border}</label><input type="range" min="0" max="20" value="${layer.bgBorderWidth}" oninput="updateLayer(${index}, 'bgBorderWidth', this)">${layer.bgBorderWidth > 0 ? `<label>${t.label_bg_border_color}</label>${createTextPaletteHTML(index, 'bgBorderColor', layer.bgBorderColor, bgBorderColorInputId)}` : ''}</div>` : ''}</div>
            <div style="margin-top:10px; opacity:0.6;"><label>${t.label_pos_layer}</label><input type="range" min="0" max="100" value="${layer.posX}" oninput="updateLayer(${index}, 'posX', this)"><input type="range" min="0" max="100" value="${layer.posY}" oninput="updateLayer(${index}, 'posY', this)"></div>`;
          container.appendChild(div);
        });
      }
      window.updateLayer = function(index, prop, element) { let val = element.value; if(element.type === 'checkbox') val = element.checked; if(typeof element === 'object' && element.value !== undefined && !element.tagName) { val = element.value; } textLayers[index][prop] = val; drawCanvas(); if(!['text','fontSize','strokeWidth','posX','posY','bgPadding','bgRadius','bgBorderWidth'].includes(prop)) { renderTextLayersUI(); } }
      function toggleStyle(index, key) { textLayers[index][key] = !textLayers[index][key]; renderTextLayersUI(); drawCanvas(); }
      function addTextLayer() { const lastFont = textLayers.length > 0 ? textLayers[textLayers.length-1].fontFamily : 'Impact'; textLayers.push({ id: Date.now(), text: 'NEW TEXT', fontSize: 80, fontFamily: lastFont, color: '#FFD700', posX: 50, posY: 50, isBold: true, isItalic: false, isUnderline: false, useStroke: true, strokeColor: '#000000', strokeWidth: 10, useBg: false, bgColor: '#000000', bgPadding: 10, bgRadius: 10, bgBorderWidth: 0, bgBorderColor: '#ffffff', shadow: true }); renderTextLayersUI(); const sectionText = document.getElementById('section-text'); if(sectionText.classList.contains('collapsed')) { jumpToSection('section-text', document.querySelectorAll('.quick-btn')[3]); } drawCanvas(); }
      function removeLayer(id) { textLayers = textLayers.filter(layer => layer.id !== id); renderTextLayersUI(); drawCanvas(); }
      function toggleGrid(type) { const grid3 = document.getElementById('checkGrid3'); const grid6 = document.getElementById('checkGrid6'); if (type === 3) { if (grid3.checked) { grid6.checked = false; activeGrid = 3; } else { activeGrid = 0; } } else if (type === 6) { if (grid6.checked) { grid3.checked = false; activeGrid = 6; } else { activeGrid = 0; } } drawCanvas(); }
      function applyPreset(type) { let targetIndex = textLayers.length - 1; if(targetIndex < 0) return; const layer = textLayers[targetIndex]; if (type === 'center-big') { layer.posX = 50; layer.posY = 50; layer.fontSize = 130; } else if (type === 'left-hook') { layer.posX = 25; layer.posY = 35; layer.fontSize = 90; } else if (type === 'split-contrast') { layer.posX = 25; layer.posY = 50; layer.fontSize = 80; } else if (type === 'bottom-story') { layer.posX = 50; layer.posY = 85; layer.fontSize = 65; } else if (type === 'corner-badge') { layer.posX = 15; layer.posY = 15; layer.fontSize = 60; } else if (type === 'diagonal-dynamic') { layer.posX = 50; layer.posY = 50; layer.fontSize = 100; } renderTextLayersUI(); drawCanvas(); }
      function snapToGrid(val, segments) { if (segments === 0) return val; const step = 100 / segments; let closest = -1; let minDiff = 100; for (let i = 1; i < segments; i++) { const line = i * step; const diff = Math.abs(val - line); if (diff < minDiff) { minDiff = diff; closest = line; } } const centerDiff = Math.abs(val - 50); if (centerDiff < minDiff) { minDiff = centerDiff; closest = 50; } if (minDiff < 2) return closest; return val; }
      function downloadImage() { drawCanvas(true); const btn = document.getElementById('saveBtn'); const originalText = btn.innerHTML; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ìµœì í™” ì¤‘...'; setTimeout(() => { let quality = 0.95; let dataURL = canvas.toDataURL('image/jpeg', quality); let sizeInBytes = (dataURL.length * 3) / 4; const targetMax = 1.9 * 1024 * 1024; while (sizeInBytes > targetMax && quality > 0.5) { quality -= 0.05; dataURL = canvas.toDataURL('image/jpeg', quality); sizeInBytes = (dataURL.length * 3) / 4; } const link = document.createElement('a'); link.download = 'youtube_thumbnail_final.jpg'; link.href = dataURL; link.click(); btn.innerHTML = originalText; drawCanvas(false); }, 100); }
      
      init();
    </script>
  </body>
</html>
