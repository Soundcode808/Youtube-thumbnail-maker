<!DOCTYPE html>
<html><head>
<base target="_top">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<title>ë”¸ê¹ ìœ íŠœë¸Œ ì¸ë„¤ì¼ ë©”ì´ì»¤ V33</title>
<style>
/* --- [1] ê¸°ë³¸ ì„¤ì • --- */
body {
    font-family: 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
    background: #121212;
    display: flex; flex-direction: column; align-items: center; padding: 20px; color: #e0e0e0;
    user-select: none; -webkit-user-select: none; -webkit-tap-highlight-color: transparent;
    height: 100vh; box-sizing: border-box; overflow: hidden;
}
* { box-sizing: border-box; }
/* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #1e1e1e; }
::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #777; }

input, textarea, select { user-select: text; -webkit-user-select: text; }
.hidden-file-input { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; opacity: 0; z-index: -1; }

.container {
    background: #1e1e1e; padding: 20px; border-radius: 12px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.7);
    max-width: 1600px; width: 100%; height: calc(100vh - 40px);
    display: grid; grid-template-rows: auto 1fr; gap: 15px; box-sizing: border-box;
}

/* í—¤ë” ì˜ì—­ */
.header-area { text-align: center; flex-shrink: 0; position: relative; }
.header-controls {
    position: absolute; top: 0; right: 0; z-index: 200;
    display: flex; flex-direction: column; align-items: flex-end; gap: 8px;
}
.lang-selector select {
    padding: 6px 10px; background: #333; color: #fff; border: 1px solid #555;
    border-radius: 6px; font-size: 12px; cursor: pointer; outline: none;
}
.social-links {
    display: flex; gap: 10px; background: rgba(255, 255, 255, 0.05);
    padding: 6px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1);
    backdrop-filter: blur(4px);
}
.social-btn {
    color: #888; font-size: 16px; transition: all 0.2s; text-decoration: none;
    display: flex; align-items: center; justify-content: center;
}
.social-btn:hover { transform: scale(1.2); }
.social-btn:hover .fa-tree { color: #43e660; }
.social-btn:hover .fa-youtube { color: #ff0000; }
.social-btn:hover .fa-threads { color: #fff; }
.social-btn:hover .fa-instagram { color: #d62976; }

h2 { margin-bottom: 5px; color: #fff; font-size: 28px; font-weight: 700; letter-spacing: -0.5px; margin-top: 0; }
h2 i { color: #ff0000; margin-right: 10px; }

/* --- [2] 3ë‹¨ ë ˆì´ì•„ì›ƒ --- */
.workspace {
    display: grid;
    grid-template-columns: 340px 1fr 320px;
    gap: 20px; height: 100%; overflow: hidden; min-height: 0;
}

/* 1. ì™¼ìª½ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
.control-panel { 
    overflow-y: auto; padding-right: 5px; height: 100%; padding-bottom: 50px; 
}

.top-toolbar-group {
    background: #252525; border: 1px solid #333; border-radius: 8px; padding: 10px; margin-bottom: 20px;
}
.settings-toolbar { display: flex; gap: 10px; margin-bottom: 10px; width: 100%; }
.settings-btn {
    flex: 1; background: #333; color: #fff; border: 1px solid #555;
    padding: 0; height: 40px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600;
    display: flex; align-items: center; justify-content: center; gap: 6px; transition: 0.2s;
}
.settings-btn:hover { background: #444; border-color: #777; }
.image-load-toolbar { margin-bottom: 10px; }
.font-manager-compact { border-top: 1px dashed #444; padding-top: 10px; }
.font-upload-btn {
    width: 100%; background: #2ba640; color: white; border: none; padding: 12px;
    border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}
.font-upload-btn:hover { background: #238a35; }

.font-list-details { margin-top: 8px; border: 1px solid #444; border-radius: 6px; overflow: hidden; }
.font-list-summary { 
    background: #333; padding: 10px; cursor: pointer; font-size: 12px; color: #fff; font-weight: bold;
    list-style: none; display: flex; justify-content: space-between; align-items: center; 
}
.font-list-summary::after { content: '\f078'; font-family: 'Font Awesome 5 Free'; font-weight: 900; transition: transform 0.2s; }
details[open] .font-list-summary::after { transform: rotate(180deg); }
.font-list-header {
    display: grid; grid-template-columns: 1fr 1fr; background: #2a2a2a; border-bottom: 1px solid #444; padding: 8px 0; font-size: 12px; color: #888; font-weight: bold;
}
.font-list-header > span { text-align: center; border-right: 1px solid #333; }
.font-list-header > span:last-child { border-right: none; }
.font-list-content { background: #1a1a1a; max-height: 200px; overflow-y: auto; }
.font-item { 
    display: grid; grid-template-columns: 1fr 1fr; padding: 10px 0; border-bottom: 1px solid #333; font-size: 12px; align-items: center;
}
.font-item:last-child { border-bottom: none; }
.font-item > span { 
    text-align: center; padding: 0 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: bold; color: #fff;
}
.font-item > span:first-child { border-right: 1px solid #333; }

/* 2. ì¤‘ì•™ ìº”ë²„ìŠ¤ */
.center-panel-wrapper {
    display: flex; flex-direction: column; height: 100%; overflow: hidden; position: relative;
    background: #181818; border-radius: 12px; border: 1px solid #333;
}
.quick-menu {
    display: flex; gap: 10px; width: 100%; justify-content: space-between; flex-shrink: 0; z-index: 10;
    background: #252525; padding: 10px; box-sizing: border-box; border-bottom: 1px solid #333;
}
.quick-btn {
    flex: 1; background: #2a2a2a; color: #aaa; border: 1px solid #444; padding: 8px; border-radius: 6px;
    cursor: pointer; font-size: 13px; font-weight: 600; text-align: center; transition: all 0.2s;
    display: flex; flex-direction: column; align-items: center; gap: 4px;
}
.quick-btn:hover { background: #333; color: #fff; }
.quick-btn.active { background: #3ea6ff; color: #000; border-color: #3ea6ff; }
.canvas-scroll-area {
    flex: 1; display: flex; flex-direction: column; overflow-y: auto; padding: 20px; box-sizing: border-box; position: relative;
}
#canvas-wrapper {
    width: 100%; max-width: 100%; aspect-ratio: 16/9; max-height: 60vh;
    border-radius: 12px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5);
    border: 1px solid #444; background: #000; margin: auto; margin-bottom: 15px;
    display: flex; justify-content: center; align-items: center; position: relative;
    cursor: crosshair; touch-action: none; flex-shrink: 0;
}
.canvas-actions { width: 100%; margin: 0 auto; display: flex; flex-direction: column; gap: 10px; flex-shrink: 0; padding-bottom: 20px; }
@supports not (aspect-ratio: 16/9) { #canvas-wrapper { height: 0; padding-bottom: 56.25%; } }
canvas { max-width: 100%; max-height: 100%; object-fit: contain; }

.donation-area { margin-top: 20px; padding-top: 15px; border-top: 1px dashed #444; text-align: center; }
.donation-area h4 { font-size: 14px; margin-bottom: 10px; color: #FFD700; }
.qr-wrapper {
    display: inline-block; padding: 10px; background: #fff; border-radius: 12px;
    border: 4px solid #FFD700; text-align: center; box-sizing: border-box;
}
.qr-img { width: 120px; height: 120px; display: block; margin: 0 auto; object-fit: contain; }

/* 3. ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°” */
.right-sidebar {
    background: #222; border-radius: 12px; padding: 15px; border: 1px solid #333;
    overflow-y: auto; display: flex; flex-direction: column; gap: 20px;
}
.youtube-card {
    background: #1a1a1a; border-radius: 10px; overflow: hidden;
    border: 1px solid #444; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    cursor: pointer; transition: transform 0.2s; flex-shrink: 0;
}
.youtube-card:hover { transform: translateY(-2px); border-color: #666; }
.yt-header {
    padding: 10px; background: #333; display: flex; align-items: center; gap: 8px;
    font-weight: bold; font-size: 13px; color: #fff; border-bottom: 1px solid #444;
}
.video-container {
    position: relative; width: 100%; padding-bottom: 56.25%; background: #000; cursor: pointer; overflow: hidden;
}
.video-container img {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.9; transition: opacity 0.3s;
}
.video-container:hover img { opacity: 1; }
.play-button {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 50px; height: 50px; background: rgba(0,0,0,0.7); border-radius: 50%;
    display: flex; justify-content: center; align-items: center; border: 2px solid #fff; pointer-events: none;
}
.video-container:hover .play-button { background: #ff0000; border-color: #ff0000; transform: translate(-50%, -50%) scale(1.1); }
.video-info { padding: 12px; }
.video-title { font-size: 13px; font-weight: 600; line-height: 1.4; margin-bottom: 5px; color: #fff; }
.video-date { font-size: 11px; color: #888; }

/* --- UI ìŠ¤íƒ€ì¼ --- */
.section { background: #2a2a2a; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; overflow: hidden; transition: all 0.3s ease; }
.section-header { padding: 15px; background: #333; cursor: pointer; display: flex; align-items: center; justify-content: space-between; user-select: none; }
.section-header:hover { background: #3a3a3a; }
.section-title { font-size: 14px; font-weight: 700; color: #f0f0f0; display: flex; align-items: center; gap: 8px; }
.section.collapsed .section-content { display: none; }
.section.collapsed .section-toggle-icon { transform: rotate(-90deg); }
.section-toggle-icon { transition: transform 0.3s; color: #888; }
.section-content { padding: 15px; border-top: 1px solid #333; }

label { display: block; font-size: 11px; margin-bottom: 4px; color: #aaa; font-weight: 600; }
input[type="text"], input[type="number"], select { width: 100%; padding: 10px; background: #121212; border: 1px solid #444; color: white; border-radius: 4px; box-sizing: border-box; margin-bottom: 8px; font-size: 13px; }
input[type="range"] { width: 100%; cursor: pointer; accent-color: #3ea6ff; margin-bottom: 8px; height: 4px; background: #444; border-radius: 2px; }
.btn { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; font-size: 14px; box-sizing: border-box; }
.btn-primary { background: #3ea6ff; color: #000; margin-bottom: 10px; }
.btn-secondary { background: #555; color: #fff; margin-bottom: 5px; font-size: 12px; padding: 10px; }
.btn-success { background: #2ba640; color: white; font-size: 16px; padding: 15px; box-shadow: 0 4px 12px rgba(43, 166, 64, 0.3); }
#saveBtn { width: auto; min-width: 60%; margin: 0 auto; }
.btn-upload { background: #333; color: #ccc; border: 1px solid #444; }

.toggle-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; padding: 4px 0; }
.toggle-label { font-size: 13px; color: #ccc; display: flex; align-items: center; gap: 6px; }
input[type="checkbox"] { width: 18px; height: 18px; accent-color: #3ea6ff; cursor: pointer; }

/* íƒ­ ìŠ¤íƒ€ì¼ */
.tab-container { display: flex; margin-bottom: 10px; background: #222; border-radius: 6px; padding: 2px; border: 1px solid #444; }
.tab-btn { flex: 1; padding: 8px; background: transparent; color: #888; border: none; cursor: pointer; border-radius: 4px; font-size: 12px; font-weight: 600; transition: 0.2s; }
.tab-btn.active { background: #3ea6ff; color: #000; }
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.2s; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

/* íŒ”ë ˆíŠ¸ ìŠ¤íƒ€ì¼ */
.palette-wrapper { margin-bottom: 10px; background: #1a1a1a; padding: 10px; border-radius: 6px; border: 1px solid #333; }
.color-grid-16 { display: grid; grid-template-columns: repeat(8, 1fr); gap: 4px; margin-bottom: 8px; }
.color-grid-8 { display: grid; grid-template-columns: repeat(8, 1fr); gap: 4px; margin-bottom: 8px; }
.color-cell { aspect-ratio: 1; border-radius: 3px; cursor: pointer; border: 1px solid #444; transition: transform 0.1s, border-color 0.1s; }
.color-cell:hover { transform: scale(1.15); border-color: #fff; z-index: 2; }
.color-cell.empty { background-image: linear-gradient(45deg, #222 25%, transparent 25%), linear-gradient(-45deg, #222 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #222 75%), linear-gradient(-45deg, transparent 75%, #222 75%); background-size: 8px 8px; background-color: #333; }
.palette-actions { display: flex; align-items: center; gap: 10px; margin-top: 5px; }
.color-preview-big { width: 40px; height: 35px; border: 1px solid #fff; border-radius: 4px; }
.btn-save-color { flex: 1; background: #333; border: 1px solid #555; color: #fff; padding: 0 10px; height: 35px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; }
.btn-save-color:hover { background: #444; }
.color-input-wrapper { display: flex; align-items: center; gap: 5px; background: #181818; padding: 6px 10px; border-radius: 4px; border: 1px solid #444; margin-bottom: 8px; }
input[type="color"] { width: 30px; height: 30px; border: none; background: none; cursor: pointer; padding: 0; flex-shrink: 0; }

.text-layer { background: #333; padding: 15px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #3ea6ff; position: relative; }
.remove-btn { position: absolute; top: 8px; right: 8px; background: none; border: none; color: #ff5252; cursor: pointer; font-size: 14px; padding: 5px; }
.style-group { display: flex; gap: 5px; margin-bottom: 8px; }
.style-btn { flex: 1; background: #444; border: 1px solid #555; color: #aaa; padding: 10px; border-radius: 4px; cursor: pointer; font-size: 14px; font-family: serif; }
.style-btn.active { background: #3ea6ff; color: #000; border-color: #3ea6ff; font-weight: bold; }

.preset-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-bottom: 10px; }
.preset-btn { background: #3a3a3a; color: #e0e0e0; font-size: 12px; padding: 12px 5px; border-radius: 6px; border: 1px solid #444; cursor: pointer; text-align: center; transition: 0.2s; display: flex; flex-direction: column; align-items: center; gap: 6px; }

.bg-control-panel { margin-top: 15px; background: #222; padding: 12px; border-radius: 6px; border: 1px solid #444; display: none; }
.bg-control-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.mini-input-group { display: flex; align-items: center; gap: 5px; }
.scale-slider-container { margin-top: 10px; padding: 10px; background: #1a1a1a; border-radius: 4px; border: 1px solid #333; display: none; }
.sub-option-box { background: #252525; padding: 10px; border-radius: 6px; margin-top: 5px; border-left: 2px solid #555; font-size: 12px; }

/* ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ íƒ­ ìŠ¤íƒ€ì¼ */
.preview-mode-tabs { display: flex; gap: 5px; margin-top: 8px; margin-bottom: 8px; }
.preview-tab-btn { flex: 1; padding: 8px 4px; background: #333; border: 1px solid #444; color: #aaa; border-radius: 4px; cursor: pointer; font-size: 11px; transition: 0.2s; }
.preview-tab-btn:hover { background: #444; color: #fff; }
.preview-tab-btn.active { background: #3ea6ff; color: #000; border-color: #3ea6ff; font-weight: bold; }

@media (max-width: 1400px) {
    .workspace { grid-template-columns: 340px 1fr; }
    .right-sidebar { display: none; }
    .container { max-width: 1200px; }
}
@media (max-width: 900px) {
    body { height: auto; overflow: auto; }
    .container { display: flex; flex-direction: column; height: auto; }
    .workspace { display: flex; flex-direction: column; height: auto; overflow: visible; }
    .control-panel { height: auto; padding-right: 0; }
    .center-panel-wrapper { 
        order: 1; margin-bottom: 10px; position: sticky; top: 0; z-index: 1000;
        background: #1e1e1e; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        border-bottom: 1px solid #333; padding-bottom: 10px; border-radius: 0 0 12px 12px;
        margin-left: -20px; margin-right: -20px; padding-left: 20px; padding-right: 20px;
    }
    .canvas-scroll-area { overflow: visible; height: auto; padding: 0; }
    .control-panel { order: 2; margin-top: 10px; }
    .right-sidebar { display: flex; order: 3; }
    .quick-menu { position: relative; top: auto; }
    .header-area { display: flex; flex-direction: column; align-items: center; }
    .header-controls { position: relative; top: auto; right: auto; width: 100%; flex-direction: row; justify-content: flex-end; align-items: center; margin-bottom: 10px; gap: 15px; }
    h2 { font-size: 20px !important; }
    #canvas-wrapper { max-height: none; }
}
</style>
<script>
document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
</script>
</head>
<body>
<div class="container">
    <div class="header-area">
        <div class="header-controls">
            <div class="lang-selector">
                <select onchange="changeLanguage(this.value)">
                    <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                </select>
            </div>
            <div class="social-links">
                <a href="https://linktr.ee/soundcode808" target="_blank" class="social-btn" title="Linktree"><i class="fas fa-tree"></i></a>
                <a href="https://www.youtube.com/@soundcode606" target="_blank" class="social-btn" title="YouTube"><i class="fab fa-youtube"></i></a>
                <a href="https://www.threads.net/@soundcode808" target="_blank" class="social-btn" title="Threads"><i class="fab fa-threads"></i></a>
                <a href="https://www.instagram.com/soundcode808/" target="_blank" class="social-btn" title="Instagram"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
        <h2 style="margin-bottom: 0px; font-size: 32px;"><i class="fab fa-youtube"></i> <span data-lang="title">ë”¸ê¹ ìœ íŠœë¸Œ ì¸ë„¤ì¼ ë©”ì´ì»¤ V33</span></h2>
        <div style="text-align: center; margin-bottom: 5px; margin-top: 5px; color: #FFD700; font-size: 18px; font-weight: bold; letter-spacing: 1px; opacity: 0.9;">
            <span data-lang="subtitle">[ ë¬´ë‹¨ ìˆ˜ì •, ë³µì œ, ì¬ë°°í¬ ê¸ˆì§€ ]</span>
        </div>
    </div>

    <div class="workspace">
        <div class="control-panel" id="mainControlPanel">
            <div class="top-toolbar-group">
                <div class="settings-toolbar">
                    <button class="settings-btn" onclick="saveSettings()">
                        <i class="fas fa-save"></i> ì„¤ì • ì €ì¥
                    </button>
                    <input type="file" id="loadSettingsInput" class="hidden-file-input" accept=".json" onchange="loadSettings(this)">
                    <label for="loadSettingsInput" class="settings-btn">
                        <i class="fas fa-folder-open"></i> ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
                    </label>
                </div>
                <div class="image-load-toolbar">
                    <input type="file" id="imageLoader" accept="image/*" class="hidden-file-input" onchange="handleImageUpload(this)">
                    <label for="imageLoader" class="btn btn-upload" style="margin-bottom:0;"><i class="fas fa-folder-open"></i> <span data-lang="btn_load_img">ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°</span></label>
                </div>
                <div class="font-manager-compact">
                    <input type="file" id="fontFileInput" class="hidden-file-input" onchange="handleFontUpload(this)" webkitdirectory="" directory="" multiple="">
                    <label for="fontFileInput" class="font-upload-btn">
                        <i class="fas fa-folder-open"></i> <span data-lang="label_font_upload">FONT í´ë” ë¶ˆëŸ¬ì˜¤ê¸° (TTF / OTF)</span>
                    </label>
                    <details class="font-list-details" id="fontListArea">
                        <summary class="font-list-summary">
                            <span>ë¶ˆëŸ¬ì˜¨ FONT ëª©ë¡ [ <span id="fontCountBadge" style="color:#FFD700; margin:0 2px;">0</span> ê°œ ]</span>
                        </summary>
                        <div class="font-list-header">
                            <span>íŒŒì¼ëª…</span>
                            <span>í°íŠ¸ëª… (í•œê¸€)</span>
                        </div>
                        <div class="font-list-content" id="loadedFontList"></div>
                    </details>
                </div>
            </div>

            <div class="section" id="section-text">
                <div class="section-header" onclick="toggleSection('section-text')">
                    <div class="section-title"><i class="fas fa-font"></i> <span data-lang="section_text">í…ìŠ¤íŠ¸</span></div>
                    <i class="fas fa-chevron-down section-toggle-icon"></i>
                </div>
                <div class="section-content">
                    <button class="btn btn-primary" onclick="addTextLayer()"><i class="fas fa-plus"></i> <span data-lang="btn_add_text">í…ìŠ¤íŠ¸ ì¶”ê°€í•˜ê¸°</span></button>
                    <div id="textLayersContainer"></div>
                </div>
            </div>

            <div class="section collapsed" id="section-bg">
                <div class="section-header" onclick="toggleSection('section-bg')">
                    <div class="section-title"><i class="fas fa-image"></i> <span data-lang="section_bg">ë°°ê²½ & ë¯¸ë¦¬ë³´ê¸°</span></div>
                    <i class="fas fa-chevron-down section-toggle-icon"></i>
                </div>
                <div class="section-content">
                    <div id="bgControlPanel" class="bg-control-panel">
                        <div class="toggle-row" style="margin-bottom:10px; padding-bottom:5px; border-bottom:1px solid #444;">
                            <span class="toggle-label" style="color:#FFD700; font-weight:bold;"><i class="fas fa-lock"></i> <span data-lang="label_lock">ì´ë¯¸ì§€ ì ê¸ˆ (Lock)</span></span>
                            <input type="checkbox" id="bgLock" onchange="updateBgLock()">
                        </div>
                        <label data-lang="label_size">í¬ê¸° ì¡°ì ˆ (Width / Height)</label>
                        <div class="bg-control-grid">
                            <div class="mini-input-group"><span style="font-size:11px; color:#888;">W</span><input type="number" id="bgWidth" oninput="updateBgSize('w')"></div>
                            <div class="mini-input-group"><span style="font-size:11px; color:#888;">H</span><input type="number" id="bgHeight" oninput="updateBgSize('h')"></div>
                        </div>
                        <div class="toggle-row" style="margin-top:5px;">
                            <span class="toggle-label" data-lang="label_ratio">ë¹„ìœ¨ ê³ ì • (Aspect Ratio)</span>
                            <input type="checkbox" id="bgRatio" checked="" onchange="toggleScaleSlider()">
                        </div>
                        <div id="scaleSliderArea" class="scale-slider-container">
                            <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><label style="margin:0; color:#3ea6ff;" data-lang="label_zoom">ğŸš€ ì „ì²´ í¬ê¸° ì¡°ì ˆ (Zoom)</label><span id="scaleValue" style="font-size:11px; color:#aaa;">100%</span></div>
                            <input type="range" id="bgScaleSlider" min="10" max="300" value="100" oninput="updateBgScale(this.value)">
                        </div>
                        <label style="margin-top:10px;" data-lang="label_pos">ìœ„ì¹˜ ì´ë™ (X / Y)</label>
                        <div class="bg-control-grid">
                            <div class="mini-input-group"><span style="font-size:11px; color:#888;">X</span><input type="number" id="bgX" oninput="updateBgPos('input')"></div>
                            <div class="mini-input-group"><span style="font-size:11px; color:#888;">Y</span><input type="number" id="bgY" oninput="updateBgPos('input')"></div>
                        </div>
                        <div style="margin-top:5px; padding:8px; background:#181818; border-radius:6px; border:1px solid #333;">
                            <div style="display:flex; align-items:center; gap:8px; margin-bottom:5px;"><span style="font-size:11px; color:#aaa; width:15px; font-weight:bold;">â†”</span><input type="range" id="bgXSlider" min="-1500" max="1500" value="0" oninput="updateBgPos('slider')"></div>
                            <div style="display:flex; align-items:center; gap:8px;"><span style="font-size:11px; color:#aaa; width:15px; font-weight:bold;">â†•</span><input type="range" id="bgYSlider" min="-1000" max="1000" value="0" oninput="updateBgPos('slider')"></div>
                        </div>
                        <button class="btn btn-secondary" onclick="resetBgImage()" style="margin-top:10px; background:#444; border-color:#555;"><i class="fas fa-undo-alt"></i> <span data-lang="btn_reset">ì´ë¯¸ì§€ í¬ê¸°/ìœ„ì¹˜ ì´ˆê¸°í™”</span></button>
                    </div>

                    <div style="margin-top: 15px; border-top: 1px solid #444; padding-top: 10px;">
                        <div class="toggle-row"><span class="toggle-label"><i class="fas fa-eye"></i> <span data-lang="label_safezone">ì‹œê°„ í‘œì‹œ (Safe Zone)</span></span><input type="checkbox" id="checkSafeZone" onchange="drawCanvas()" checked=""></div>
                        
                        <div class="sub-option-box" id="previewModeContainer" style="margin-bottom:10px;">
                            <label style="color:#3ea6ff;">ğŸ“º ë¯¸ë¦¬ë³´ê¸° ë·° (ì‹œê°„ í‘œì‹œ ë¹„ìœ¨)</label>
                            <div class="preview-mode-tabs">
                                <button class="preview-tab-btn" onclick="setPreviewMode('main', this)">ë©”ì¸í™”ë©´(ëŒ€)</button>
                                <button class="preview-tab-btn active" onclick="setPreviewMode('rec', this)">ì¶”ì²œì˜ìƒ(ì¤‘)</button>
                                <button class="preview-tab-btn" onclick="setPreviewMode('mobile', this)">ëª¨ë°”ì¼/ì¸ê¸°(ì†Œ)</button>
                            </div>
                            <p style="font-size:10px; color:#888; margin:0;">* ì‹¤ì œ ìœ íŠœë¸Œ í™”ë©´ ë¹„ìœ¨ì— ë§ì¶° ì‹œê°„í‘œì‹œ í¬ê¸°ê°€ ë³€í•©ë‹ˆë‹¤.</p>
                        </div>

                        <div class="toggle-row" style="margin-left: 10px;"><span class="toggle-label"><i class="fas fa-music"></i> <span data-lang="label_music">ìŒí‘œ ì•„ì´ì½˜ (ë®¤ì§ë¹„ë””ì˜¤)</span></span><input type="checkbox" id="checkMusicIcon" onchange="drawCanvas()"></div>
                        <div class="toggle-row" style="margin-top: 10px;"><span class="toggle-label"><i class="fas fa-th"></i> <span data-lang="label_grid12">12ë¶„í•  ê·¸ë¦¬ë“œ (ìì„)</span></span><input type="checkbox" id="checkGrid12" onchange="toggleGrid(12)"></div>
                        <div class="toggle-row"><span class="toggle-label"><i class="fas fa-th"></i> <span data-lang="label_grid6">6ë¶„í•  ê·¸ë¦¬ë“œ (ìì„)</span></span><input type="checkbox" id="checkGrid6" onchange="toggleGrid(6)"></div>
                    </div>
                </div>
            </div>

            <div class="section collapsed" id="section-effect">
                <div class="section-header" onclick="toggleSection('section-effect')">
                    <div class="section-title"><i class="fas fa-magic"></i> <span data-lang="section_effect">íš¨ê³¼</span></div>
                    <i class="fas fa-chevron-down section-toggle-icon"></i>
                </div>
                <div class="section-content">
                    <div class="toggle-row"><span class="toggle-label" data-lang="label_shadow">ğŸ¬ ì‹œë„¤ë§ˆí‹± ê·¸ë¦¼ì (í•˜ë‹¨)</span><input type="checkbox" id="checkGradient" onchange="drawCanvas()" checked=""></div>
                    <input type="range" id="gradIntensity" min="0" max="100" value="70" oninput="drawCanvas()">
                    <hr style="border: 0; border-top: 1px solid #444; margin: 10px 0;">
                    <div class="toggle-row"><span class="toggle-label" data-lang="label_border">ğŸ–¼ï¸ ì¸ë„¤ì¼ í…Œë‘ë¦¬</span><input type="checkbox" id="checkBorder" onchange="drawCanvas()"></div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <div><label data-lang="label_thickness">ë‘ê»˜</label><input type="number" id="borderWidth" value="15" oninput="drawCanvas()"></div>
                        <div><label data-lang="label_radius">ë¼ìš´ë”©</label><input type="number" id="borderRadius" value="30" oninput="drawCanvas()"></div>
                    </div>
                    <label style="margin-top:5px;" data-lang="label_border_color">í…Œë‘ë¦¬ ìƒ‰ìƒ</label>
                    <div class="palette-wrapper">
                         <div class="color-grid-16" id="borderPalette16"></div>
                         <div class="color-grid-8" id="borderPaletteCustom"></div>
                         <div class="palette-actions">
                             <div class="color-preview-big" id="borderPreviewBox" style="background:#FFD700"></div>
                             <button class="btn-save-color" onclick="saveToCustomPaletteFromBorder()"><i class="fas fa-plus"></i> ìƒ‰ ì €ì¥</button>
                         </div>
                    </div>
                    <div class="color-input-wrapper"><input type="color" id="borderColor" value="#FFD700" oninput="updateBorderColor(this.value, true)"></div>
                </div>
            </div>

            <div class="section collapsed" id="section-layout">
                <div class="section-header" onclick="toggleSection('section-layout')">
                    <div class="section-title"><i class="fas fa-th-large"></i> <span data-lang="section_layout">ë°°ì¹˜ (12ì¢…)</span></div>
                    <i class="fas fa-chevron-down section-toggle-icon"></i>
                </div>
                <div class="section-content">
                    <div class="preset-grid">
                        <div class="preset-btn" onclick="applyPreset('center-big')"><i class="fas fa-bullseye"></i> <span data-lang="preset_center">ì¤‘ì•™ ì´ˆëŒ€í˜•</span></div>
                        <div class="preset-btn" onclick="applyPreset('left-hook')"><i class="fas fa-align-left"></i> <span data-lang="preset_hook">ì¢Œì¸¡ í›…(Hook)</span></div>
                        <div class="preset-btn" onclick="applyPreset('split-contrast')"><i class="fas fa-columns"></i> <span data-lang="preset_split">ì¢Œìš° ë¶„í• </span></div>
                        <div class="preset-btn" onclick="applyPreset('bottom-story')"><i class="fas fa-quote-left"></i> <span data-lang="preset_bottom">í•˜ë‹¨ ìë§‰í˜•</span></div>
                        <div class="preset-btn" onclick="applyPreset('corner-badge')"><i class="fas fa-certificate"></i> <span data-lang="preset_badge">ì¢Œìƒë‹¨ ë±ƒì§€</span></div>
                        <div class="preset-btn" onclick="applyPreset('diagonal-dynamic')"><i class="fas fa-slash"></i> <span data-lang="preset_diagonal">ëŒ€ê°ì„  ë°°ì¹˜</span></div>
                        <div class="preset-btn" onclick="applyPreset('top-title')"><i class="fas fa-heading"></i> <span>ìƒë‹¨ ì œëª©í˜•</span></div>
                        <div class="preset-btn" onclick="applyPreset('right-hook')"><i class="fas fa-align-right"></i> <span>ìš°ì¸¡ í›…</span></div>
                        <div class="preset-btn" onclick="applyPreset('four-corners')"><i class="fas fa-expand"></i> <span>ë„¤ ê·€í‰ì´</span></div>
                        <div class="preset-btn" onclick="applyPreset('cinematic-title')"><i class="fas fa-film"></i> <span>ì‹œë„¤ë§ˆí‹±</span></div>
                        <div class="preset-btn" onclick="applyPreset('versus-mode')"><i class="fas fa-compress-arrows-alt"></i> <span>VS ëŒ€ê²°í˜•</span></div>
                        <div class="preset-btn" onclick="applyPreset('speech-bubble')"><i class="fas fa-comment-dots"></i> <span>ë§í’ì„ í˜•</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="center-panel-wrapper">
            <div class="quick-menu">
                <div class="quick-btn active" onclick="jumpToSection('section-text', this)"><i class="fas fa-font"></i> <span data-lang="menu_text">í…ìŠ¤íŠ¸</span></div>
                <div class="quick-btn" onclick="jumpToSection('section-bg', this)"><i class="fas fa-image"></i> <span data-lang="menu_bg">ë°°ê²½</span></div>
                <div class="quick-btn" onclick="jumpToSection('section-effect', this)"><i class="fas fa-magic"></i> <span data-lang="menu_effect">íš¨ê³¼</span></div>
                <div class="quick-btn" onclick="jumpToSection('section-layout', this)"><i class="fas fa-th-large"></i> <span data-lang="menu_layout">ë°°ì¹˜</span></div>
            </div>
            <div class="canvas-scroll-area">
                <div id="canvas-wrapper">
                    <canvas id="mainCanvas" width="1280" height="720" style="cursor: default;"></canvas>
                </div>
                <div class="canvas-actions">
                    <div style="display: flex; gap: 15px; width: 100%; justify-content: space-between; font-size: 12px; color: #888;">
                        <span><i class="fas fa-mouse-pointer"></i> <b data-lang="tip_drag">Tip: ë“œë˜ê·¸ ì‹œ ê·¸ë¦¬ë“œì— ìì„ì²˜ëŸ¼ ë¶™ìŠµë‹ˆë‹¤.</b></span>
                        <span><i class="fas fa-file-image"></i> 1280x720 (Max 2MB)</span>
                    </div>
                    <button class="btn btn-success" id="saveBtn" onclick="downloadImage()"><i class="fas fa-download"></i> <span data-lang="btn_save">ì¸ë„¤ì¼ ì €ì¥í•˜ê¸° (ìë™ ìµœì í™”)</span></button>
                    <div class="donation-area">
                        <h4><i class="fas fa-coffee"></i> <span data-lang="donation_title">[ê°œë°œìì—ê²Œ ì»¤í”¼ ì˜ê¸°]</span></h4>
                        <div class="donation-link">
                            <div class="qr-wrapper">
                                <img src="QRì½”ë“œ.png" class="qr-img" alt="QR Code" onerror="this.src=''; this.alt='QRì½”ë“œ.png íŒŒì¼ì´ ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”';">
                                <div style="font-size: 10px; color: #333; margin-top: 5px;">Kakaopay QR</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-sidebar">
            <div class="youtube-card" id="ytCard">
                <div class="yt-header"><i class="fab fa-youtube"></i> NEW VIDEO</div>
                <div class="video-container" id="videoContainer" onclick="playInlineVideo(this, 'TdTZ3wiJsWQ')">
                    <img src="https://img.youtube.com/vi/TdTZ3wiJsWQ/maxresdefault.jpg" alt="Thumbnail" onerror="this.src='https://img.youtube.com/vi/TdTZ3wiJsWQ/hqdefault.jpg'">
                    <div class="play-button"><i class="fas fa-play"></i></div>
                </div>
                <div class="video-info">
                    <div class="video-title" id="videoTitle">[Official Theme] ë‹¨êµ° (DANGUN) : ğŸ—¡ï¸ Epic Cinematic Music | ì‹œë„¤ë§ˆí‹± íŒíƒ€ì§€ OST</div>
                    <div class="video-date" id="videoDate">2025-12-06</div>
                </div>
            </div>
            <div class="youtube-card">
                <div class="yt-header"><i class="fas fa-list-ul"></i> K-POP List</div>
                <div class="video-container" onclick="playInlineVideo(this, 'BHiVDQ3fzYo')">
                    <img src="https://img.youtube.com/vi/BHiVDQ3fzYo/hqdefault.jpg" alt="K-POP Thumbnail">
                    <div class="play-button"><i class="fas fa-play"></i></div>
                </div>
                <div class="video-info">
                    <div class="video-title">ğŸµ K-POP ì¸ê¸°ê³¡ ëª¨ìŒ</div>
                    <div class="video-date">í´ë¦­í•˜ì—¬ ì¬ìƒ</div>
                </div>
            </div>
            <div class="youtube-card">
                <div class="yt-header"><i class="fas fa-list-ul"></i> J-POP List</div>
                <div class="video-container" onclick="playInlineVideo(this, 'KMqhMIZ-NbE')">
                    <img src="https://img.youtube.com/vi/KMqhMIZ-NbE/hqdefault.jpg" alt="J-POP Thumbnail">
                    <div class="play-button"><i class="fas fa-play"></i></div>
                </div>
                <div class="video-info">
                    <div class="video-title">ğŸµ J-POP ì¸ê¸°ê³¡ ëª¨ìŒ</div>
                    <div class="video-date">í´ë¦­í•˜ì—¬ ì¬ìƒ</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// --- ì–¸ì–´ ë°ì´í„° ë³µêµ¬ ---
const translations = {
    ko: {title: "ë”¸ê¹ ìœ íŠœë¸Œ ì¸ë„¤ì¼ ë©”ì´ì»¤ V33", subtitle: "[ ë¬´ë‹¨ ìˆ˜ì •, ë³µì œ, ì¬ë°°í¬ ê¸ˆì§€ ]",
        section_bg: "ë°°ê²½ & ë¯¸ë¦¬ë³´ê¸°", btn_load_img: "ì´ë¯¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸°", label_lock: "ì´ë¯¸ì§€ ì ê¸ˆ (Lock)", label_size: "í¬ê¸° ì¡°ì ˆ (Width / Height)", label_ratio: "ë¹„ìœ¨ ê³ ì • (Aspect Ratio)", label_zoom: "ğŸš€ ì „ì²´ í¬ê¸° ì¡°ì ˆ (Zoom)", label_pos: "ìœ„ì¹˜ ì´ë™ (X / Y)", btn_reset: "ì´ë¯¸ì§€ í¬ê¸°/ìœ„ì¹˜ ì´ˆê¸°í™”", label_safezone: "ì‹œê°„ í‘œì‹œ (Safe Zone)", label_music: "ìŒí‘œ ì•„ì´ì½˜ (ë®¤ì§ë¹„ë””ì˜¤)", label_grid12: "12ë¶„í•  ê·¸ë¦¬ë“œ (ìì„)", label_grid6: "6ë¶„í•  ê·¸ë¦¬ë“œ (ìì„)",
        section_layout: "ë°°ì¹˜ (12ì¢…)", preset_center: "ì¤‘ì•™ ì´ˆëŒ€í˜•", preset_hook: "ì¢Œì¸¡ í›…(Hook)", preset_split: "ì¢Œìš° ë¶„í• ", preset_bottom: "í•˜ë‹¨ ìë§‰í˜•", preset_badge: "ì¢Œìƒë‹¨ ë±ƒì§€", preset_diagonal: "ëŒ€ê°ì„  ë°°ì¹˜",
        section_effect: "íš¨ê³¼", label_shadow: "ğŸ¬ ì‹œë„¤ë§ˆí‹± ê·¸ë¦¼ì (í•˜ë‹¨)", label_border: "ğŸ–¼ï¸ ì¸ë„¤ì¼ í…Œë‘ë¦¬", label_thickness: "ë‘ê»˜", label_radius: "ë¼ìš´ë”©", label_border_color: "í…Œë‘ë¦¬ ìƒ‰ìƒ",
        section_text: "í…ìŠ¤íŠ¸", label_font_upload: "FONT í´ë” ë¶ˆëŸ¬ì˜¤ê¸° ( TTF / OTF )", btn_font_select: "í°íŠ¸ í´ë” ì„ íƒ (ttf/otf)", btn_add: "ì¶”ê°€", desc_iphone: "* ì•„ì´í°ì€ 'íŒŒì¼' ì•±ì— ì €ì¥ëœ í°íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.", btn_add_text: "í…ìŠ¤íŠ¸ ì¶”ê°€í•˜ê¸°",
        menu_bg: "ë°°ê²½", menu_layout: "ë°°ì¹˜", menu_effect: "íš¨ê³¼", menu_text: "í…ìŠ¤íŠ¸",
        tip_drag: "Tip: ë“œë˜ê·¸ ì‹œ ê·¸ë¦¬ë“œì— ìì„ì²˜ëŸ¼ ë¶™ìŠµë‹ˆë‹¤.", btn_save: "ì¸ë„¤ì¼ ì €ì¥í•˜ê¸° (ìë™ ìµœì í™”)", donation_title: "[ê°œë°œìì—ê²Œ ì»¤í”¼ ì˜ê¸°]",
        label_content: "ë‚´ìš©", label_font: "ê¸€ê¼´", label_layer_size: "í¬ê¸°", label_style: "ìŠ¤íƒ€ì¼", label_text_color: "í…ìŠ¤íŠ¸ ìƒ‰ìƒ", btn_save_color: "ìƒ‰ ì €ì¥", label_stroke: "ê¸€ì ì™¸ê³½ì„ ", label_layer_thickness: "ë‘ê»˜", label_stroke_color: "ìƒ‰ìƒ", label_bgbox: "ë°°ê²½ ë°•ìŠ¤", label_bgcolor: "ë°°ê²½ ìƒ‰ìƒ", label_padding: "ì—¬ë°±", label_bg_radius: "ë‘¥ê¸€ê¸°", label_bg_border: "ë°°ê²½ í…Œë‘ë¦¬", label_bg_border_color: "í…Œë‘ë¦¬ ìƒ‰ìƒ", label_pos_layer: "ìœ„ì¹˜ ë¯¸ì„¸ì¡°ì •"
    },
    en: {title: "Click Youtube Thumbnail Maker V33", subtitle: "[ No Unauthorized Mod/Copy/Distribute ]",
        section_bg: "BG & Preview", btn_load_img: "Load Image", label_lock: "Lock Image", label_size: "Resize (W / H)", label_ratio: "Aspect Ratio", label_zoom: "ğŸš€ Zoom", label_pos: "Position (X / Y)", btn_reset: "Reset Image", label_safezone: "Safe Zone", label_music: "Music Icon", label_grid12: "Grid 12x12 (Snap)", label_grid6: "Grid 6x6 (Snap)",
        section_layout: "Layouts (12)", preset_center: "Center Big", preset_hook: "Left Hook", preset_split: "Split Contrast", preset_bottom: "Bottom Story", preset_badge: "Corner Badge", preset_diagonal: "Diagonal",
        section_effect: "Effects", label_shadow: "ğŸ¬ Cinematic Shadow", label_border: "ğŸ–¼ï¸ Border", label_thickness: "Width", label_radius: "Radius", label_border_color: "Border Color",
        section_text: "Text", label_font_upload: "Upload FONT Folder (TTF/OTF)", btn_font_select: "Select Font Folder", btn_add: "Add", desc_iphone: "* iPhone: Select from 'Files' app.", btn_add_text: "Add Text",
        menu_bg: "BG", menu_layout: "Layout", menu_effect: "Effect", menu_text: "Text",
        tip_drag: "Tip: Draggable items snap to grid.", btn_save: "Save Thumbnail", donation_title: "[Buy me a coffee]",
        label_content: "Content", label_font: "Font", label_layer_size: "Size", label_style: "Style", label_text_color: "Text Color", btn_save_color: "Save Color", label_stroke: "Stroke", label_layer_thickness: "Width", label_stroke_color: "Color", label_bgbox: "Background Box", label_bgcolor: "BG Color", label_padding: "Padding", label_bg_radius: "Radius", label_bg_border: "Box Border", label_bg_border_color: "Border Color", label_pos_layer: "Position"
    },
    ja: {title: "ã‚¯ãƒªãƒƒã‚¯ï¼YouTubeã‚µãƒ ãƒãƒ¡ãƒ¼ã‚«ãƒ¼ V33", subtitle: "[ ç„¡æ–­ä¿®æ­£ãƒ»è¤‡è£½ãƒ»å†é…å¸ƒç¦æ­¢ ]",
        section_bg: "èƒŒæ™¯ï¼†ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼", btn_load_img: "ç”»åƒã‚’èª­ã¿è¾¼ã‚€", label_lock: "ç”»åƒã‚’ãƒ­ãƒƒã‚¯", label_size: "ã‚µã‚¤ã‚ºèª¿æ•´ (W / H)", label_ratio: "æ¯”ç‡ã‚’å›ºå®š", label_zoom: "ğŸš€ ã‚ºãƒ¼ãƒ ", label_pos: "ä½ç½®ç§»å‹• (X / Y)", btn_reset: "ç”»åƒãƒªã‚»ãƒƒãƒˆ", label_safezone: "ã‚»ãƒ¼ãƒ•ã‚¾ãƒ¼ãƒ³", label_music: "éŸ³ç¬¦ã‚¢ã‚¤ã‚³ãƒ³", label_grid12: "12åˆ†å‰²ã‚°ãƒªãƒƒãƒ‰", label_grid6: "6åˆ†å‰²ã‚°ãƒªãƒƒãƒ‰",
        section_layout: "é…ç½® (12ç¨®)", preset_center: "ä¸­å¤®ç‰¹å¤§", preset_hook: "å·¦ãƒ•ãƒƒã‚¯", preset_split: "å·¦å³åˆ†å‰²", preset_bottom: "ä¸‹éƒ¨å­—å¹•", preset_badge: "å·¦ä¸Šãƒãƒƒã‚¸", preset_diagonal: "å¯¾è§’ç·šé…ç½®",
        section_effect: "åŠ¹æœ", label_shadow: "ğŸ¬ æ˜ ç”»é¢¨ã‚·ãƒ£ãƒ‰ã‚¦", label_border: "ğŸ–¼ï¸ æ ç·š", label_thickness: "å¤ªã•", label_radius: "è§’ä¸¸", label_border_color: "æ ç·šã®è‰²",
        section_text: "ãƒ†ã‚­ã‚¹ãƒˆ", label_font_upload: "ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€èª­è¾¼ (TTF/OTF)", btn_font_select: "ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€é¸æŠ", btn_add: "è¿½åŠ ", desc_iphone: "* iPhoneã¯ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚¢ãƒ—ãƒªã‹ã‚‰é¸æŠã€‚", btn_add_text: "ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ ",
        menu_bg: "èƒŒæ™¯", menu_layout: "é…ç½®", menu_effect: "åŠ¹æœ", menu_text: "æ–‡å­—",
        tip_drag: "Tip: ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚°ãƒªãƒƒãƒ‰ã«å¸ç€ã€‚", btn_save: "ä¿å­˜ (æœ€é©åŒ–)", donation_title: "[é–‹ç™ºè€…ã«ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’]",
        label_content: "å†…å®¹", label_font: "ãƒ•ã‚©ãƒ³ãƒˆ", label_layer_size: "ã‚µã‚¤ã‚º", label_style: "ã‚¹ã‚¿ã‚¤ãƒ«", label_text_color: "æ–‡å­—è‰²", btn_save_color: "è‰²ä¿å­˜", label_stroke: "ç¸å–ã‚Š", label_layer_thickness: "å¤ªã•", label_stroke_color: "è‰²", label_bgbox: "èƒŒæ™¯ãƒœãƒƒã‚¯ã‚¹", label_bgcolor: "èƒŒæ™¯è‰²", label_padding: "ä½™ç™½", label_bg_radius: "è§’ä¸¸", label_bg_border: "æ ç·š", label_bg_border_color: "æ è‰²", label_pos_layer: "ä½ç½®"
    },
    zh: {title: "ç‚¹å‡» YouTube ç¼©ç•¥å›¾åˆ¶ä½œå·¥å…· V33", subtitle: "[ ç¦æ­¢æ“…è‡ªä¿®æ”¹ã€å¤åˆ¶ã€å†åˆ†å‘ ]",
        section_bg: "èƒŒæ™¯ä¸é¢„è§ˆ", btn_load_img: "åŠ è½½å›¾ç‰‡", label_lock: "é”å®šå›¾ç‰‡", label_size: "è°ƒæ•´å¤§å° (W / H)", label_ratio: "é”å®šæ¯”ä¾‹", label_zoom: "ğŸš€ ç¼©æ”¾", label_pos: "ç§»åŠ¨ä½ç½® (X / Y)", btn_reset: "é‡ç½®å›¾ç‰‡", label_safezone: "å®‰å…¨åŒº", label_music: "éŸ³ç¬¦å›¾æ ‡", label_grid12: "12åˆ†ç½‘æ ¼", label_grid6: "6åˆ†ç½‘æ ¼",
        section_layout: "å¸ƒå±€ (12ç§)", preset_center: "ä¸­å¤®è¶…å¤§", preset_hook: "å·¦ä¾§é’©å­", preset_split: "å·¦å³åˆ†å‰²", preset_bottom: "åº•éƒ¨å­—å¹•", preset_badge: "å·¦ä¸Šè§’å¾½ç« ", preset_diagonal: "å¯¹è§’çº¿å¸ƒå±€",
        section_effect: "æ•ˆæœ", label_shadow: "ğŸ¬ ç”µå½±æ„Ÿé˜´å½±", label_border: "ğŸ–¼ï¸ è¾¹æ¡†", label_thickness: "å®½åº¦", label_radius: "åœ†è§’", label_border_color: "è¾¹æ¡†é¢œè‰²",
        section_text: "æ–‡æœ¬", label_font_upload: "åŠ è½½å­—ä½“æ–‡ä»¶å¤¹ (TTF/OTF)", btn_font_select: "é€‰æ‹©å­—ä½“æ–‡ä»¶å¤¹", btn_add: "æ·»åŠ ", desc_iphone: "* iPhone è¯·ä»â€œæ–‡ä»¶â€Appé€‰æ‹©ã€‚", btn_add_text: "æ·»åŠ æ–‡æœ¬",
        menu_bg: "èƒŒæ™¯", menu_layout: "å¸ƒå±€", menu_effect: "æ•ˆæœ", menu_text: "æ–‡æœ¬",
        tip_drag: "æç¤º: æ‹–åŠ¨æ—¶å¸é™„ç½‘æ ¼ã€‚", btn_save: "ä¿å­˜ç¼©ç•¥å›¾", donation_title: "[è¯·å¼€å‘è€…å–å’–å•¡]",
        label_content: "å†…å®¹", label_font: "å­—ä½“", label_layer_size: "å¤§å°", label_style: "æ ·å¼", label_text_color: "æ–‡æœ¬é¢œè‰²", btn_save_color: "ä¿å­˜é¢œè‰²", label_stroke: "æè¾¹", label_layer_thickness: "å®½åº¦", label_stroke_color: "é¢œè‰²", label_bgbox: "èƒŒæ™¯æ¡†", label_bgcolor: "èƒŒæ™¯é¢œè‰²", label_padding: "å†…è¾¹è·", label_bg_radius: "åœ†è§’", label_bg_border: "æ¡†è¾¹æ¡†", label_bg_border_color: "è¾¹æ¡†é¢œè‰²", label_pos_layer: "ä½ç½®"
    }
};
let currentLang = 'ko';

function changeLanguage(lang) {
    currentLang = lang;
    document.querySelectorAll('[data-lang]').forEach(el => {
        const key = el.getAttribute('data-lang');
        if(translations[lang][key]) el.innerHTML = translations[lang][key];
    });
    renderLayersUI(); 
}

// --- ê¸°ë³¸ ë³€ìˆ˜ ---
const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d');
let layers = [];
let bgImage = null;
let bgConfig = { x: 0, y: 0, width: 1280, height: 720, scale: 1, aspectRatio: 1280/720, isLocked: true };
let isDragging = false;
let dragLayerIndex = -1;
let dragStart = { x: 0, y: 0 };
let activeGrid = 0; 
let customPalette = new Array(8).fill(null);
const smartColors = ['#FFFFFF', '#000000', '#FF0000', '#FFFF00', '#00FF00', '#00FFFF', '#0000FF', '#FF00FF', '#FFA500', '#800080', '#FFC0CB', '#A52A2A', '#808080', '#D3D3D3', '#FFD700', '#40E0D0'];
let customFonts = []; 
let previewMode = 'rec';

// í•œê¸€ í°íŠ¸ ë³€í™˜ ë§¤í•‘
const kFontMap = { 'Nanum':'ë‚˜ëˆ”', 'Barun':'ë°”ë¥¸', 'Pen':'íœ', 'Gothic':'ê³ ë”•', 'Myeongjo':'ëª…ì¡°', 'Yeongam':'ì˜ì•”', 'Wolchulsan':'ì›”ì¶œì‚°', 'Miwon':'ë¯¸ì›', 'Jua':'ì£¼ì•„', 'DoHyeon':'ë„í˜„', 'Black':'ë¸”ë™', 'Han':'í•œ', 'Sans':'ì‚°ìŠ¤', 'Cookie':'ì¿ í‚¤', 'Run':'ëŸ°', 'Jalnan':'ì˜ë‚œ', 'Gmarket':'ì§€ë§ˆì¼“', 'Sangsang':'ìƒìƒ', 'Rabbit':'í† ë¼', 'Mapo':'ë§ˆí¬', 'Flower':'ê½ƒ', 'Road':'ê¸¸', 'Human':'íœ´ë¨¼', 'Batang':'ë°”íƒ•', 'Dotum':'ë‹ì›€', 'Gungsuh':'ê¶ì„œ', 'Pilgi':'í•„ê¸°', 'Saemul':'ìƒ˜ë¬¼', 'Headline':'í—¤ë“œë¼ì¸', 'D2Coding':'D2ì½”ë”©', 'DungGeun':'ë‘¥ê·¼', 'Mo':'ëª¨' };

function translateFontName(filename) {
    let name = filename.replace(/\.(otf|OTF|ttf|TTF)$/, '');
    if (/[ê°€-í£]/.test(name)) {
        name = name.replace(/[a-zA-Z]{2,}/g, '');
        name = name.replace(/[-_\s]+/g, '');
    } else {
        name = name.replace(/[-_]/g, ' ');
        Object.keys(kFontMap).forEach(key => {
            const regex = new RegExp(key, 'gi');
            name = name.replace(regex, kFontMap[key]);
        });
        name = name.replace(/\s+/g, '');
    }
    if (!name.endsWith('ì²´')) name += 'ì²´';
    return name;
}

// í°íŠ¸ ë¡œë“œ
function handleFontUpload(input) {
    if(input.files) {
        const fileList = Array.from(input.files);
        const fontGroups = {};
        fileList.forEach(file => {
            const ext = file.name.split('.').pop().toLowerCase();
            if (ext !== 'otf' && ext !== 'ttf') return;
            const baseName = file.name.substring(0, file.name.lastIndexOf('.'));
            if (!fontGroups[baseName]) fontGroups[baseName] = {};
            fontGroups[baseName][ext] = file;
        });
        Object.keys(fontGroups).forEach(baseName => {
            const group = fontGroups[baseName];
            const targetFile = group.otf || group.ttf;
            if (targetFile) loadSingleFont(targetFile);
        });
        setTimeout(() => {
            document.getElementById('fontCountBadge').innerText = customFonts.length;
            renderLayersUI();
        }, 500);
    }
}

function loadSingleFont(file) {
    const originalName = file.name.split('.')[0];
    const fontName = originalName.replace(/\s+/g, '');
    const displayName = translateFontName(file.name);
    if (customFonts.some(f => f.name === fontName)) return;

    customFonts.push({ name: fontName, displayName: displayName });
    const reader = new FileReader();
    reader.onload = (e) => {
        const fontFace = new FontFace(fontName, `url(${e.target.result})`);
        fontFace.load().then((loadedFace) => {
            document.fonts.add(loadedFace);
            renderLayersUI(); 
        });
    };
    reader.readAsDataURL(file);
    const list = document.getElementById('loadedFontList');
    const div = document.createElement('div');
    div.className = 'font-item';
    div.innerHTML = `<span>${file.name}</span><span>${displayName}</span>`;
    list.appendChild(div);
}

// ë ˆì´ì–´ ê´€ë¦¬
function initLayers() {
    layers = [{
        id: Date.now(), text: 'ì¸ë„¤ì¼ ì œëª©', x: 640, y: 360, fontSize: 100, fontFamily: 'Impact',
        color: '#FFFFFF', useStroke: true, strokeColor: '#000000', strokeWidth: 15,
        isBold: false, isItalic: false, isUnderline: false, useBg: false, bgColor: '#000000',
        activeTab: 'text'
    }];
    renderLayersUI();
    renderBorderPalette();
    drawCanvas();
}

function setLayerTab(idx, tabName) {
    layers[idx].activeTab = tabName;
    renderLayersUI();
}

function setPreviewMode(mode, btn) {
    previewMode = mode;
    document.querySelectorAll('.preview-tab-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    drawCanvas();
}

function generateTabPaletteHTML(idx, type) {
    const isText = type === 'text';
    const currentVal = isText ? layers[idx].color : layers[idx].strokeColor;
    const clickAction = isText 
        ? `updateLayer(${idx}, 'color', {value: 'COLOR'})` 
        : `updateLayer(${idx}, 'strokeColor', {value: 'COLOR'})`;
    
    let html = '<div class="palette-wrapper">';
    html += '<div class="color-grid-16">';
    smartColors.forEach(c => {
        html += `<div class="color-cell" style="background:${c}" onclick="${clickAction.replace('COLOR', c)}"></div>`;
    });
    html += '</div>';
    
    html += '<div class="color-grid-8">';
    customPalette.forEach(c => {
        if(c) html += `<div class="color-cell" style="background:${c}" onclick="${clickAction.replace('COLOR', c)}"></div>`;
        else html += `<div class="color-cell empty"></div>`;
    });
    html += '</div>';
    
    const saveAction = isText ? `saveToCustomPalette('${layers[idx].color}')` : `saveToCustomPalette('${layers[idx].strokeColor}')`;
    html += `<div class="palette-actions">
        <div class="color-preview-big" style="background:${currentVal}"></div>
        <button class="btn-save-color" onclick="${saveAction}"><i class="fas fa-plus"></i> ${translations[currentLang].btn_save_color}</button>
    </div></div>`;
    
    const pickerId = isText ? `textColor_${idx}` : `strokeColor_${idx}`;
    const updateFn = isText ? `updateLayer(${idx}, 'color', this)` : `updateLayer(${idx}, 'strokeColor', this)`;
    html += `<div class="color-input-wrapper"><input type="color" id="${pickerId}" value="${currentVal}" oninput="${updateFn}"></div>`;
    return html;
}

function renderLayersUI() {
    const t = translations[currentLang];
    const container = document.getElementById('textLayersContainer');
    container.innerHTML = '';
    
    layers.forEach((layer, idx) => {
        const div = document.createElement('div');
        div.className = 'text-layer';
        
        let fontOptions = `
            <option value="Impact" ${layer.fontFamily === 'Impact' ? 'selected' : ''}>Impact</option>
            <option value="sans-serif" ${layer.fontFamily === 'sans-serif' ? 'selected' : ''}>ê³ ë”• (ê¸°ë³¸)</option>
            <option value="serif" ${layer.fontFamily === 'serif' ? 'selected' : ''}>ëª…ì¡° (ì§„ì§€)</option>
            <option value="Black Han Sans" ${layer.fontFamily === 'Black Han Sans' ? 'selected' : ''}>Black Han Sans</option>
            <option value="Jua" ${layer.fontFamily === 'Jua' ? 'selected' : ''}>ì£¼ì•„ì²´</option>
        `;
        customFonts.forEach(f => {
            fontOptions += `<option value="${f.name}" ${layer.fontFamily === f.name ? 'selected' : ''}>ğŸ“‚ ${f.displayName}</option>`;
        });

        const isTextTab = layer.activeTab !== 'outline';
        
        div.innerHTML = `
            <button class="remove-btn" onclick="removeLayer(${layer.id})"><i class="fas fa-times"></i></button>
            <label>${t.label_content}</label><input type="text" value="${layer.text}" oninput="updateLayer(${idx}, 'text', this)">
            <div style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 8px; margin-bottom: 6px;">
                <div>
                    <label>${t.label_font}</label>
                    <select onchange="updateLayer(${idx}, 'fontFamily', this)">${fontOptions}</select>
                </div>
                <div><label>${t.label_layer_size}</label><input type="number" value="${layer.fontSize}" oninput="updateLayer(${idx}, 'fontSize', this)"></div>
            </div>
            
            <div class="style-group">
                <button class="style-btn ${layer.isBold ? 'active' : ''}" onclick="toggleStyle(${idx}, 'isBold')">B</button>
                <button class="style-btn ${layer.isItalic ? 'active' : ''}" onclick="toggleStyle(${idx}, 'isItalic')">I</button>
                <button class="style-btn ${layer.isUnderline ? 'active' : ''}" onclick="toggleStyle(${idx}, 'isUnderline')">U</button>
            </div>
            
            <div class="tab-container">
                <button class="tab-btn ${isTextTab ? 'active' : ''}" onclick="setLayerTab(${idx}, 'text')"><i class="fas fa-palette"></i> ${t.label_text_color}</button>
                <button class="tab-btn ${!isTextTab ? 'active' : ''}" onclick="setLayerTab(${idx}, 'outline')"><i class="fas fa-pen"></i> ${t.label_stroke}</button>
            </div>
            
            <div class="tab-content ${isTextTab ? 'active' : ''}">
                ${generateTabPaletteHTML(idx, 'text')}
            </div>
            
            <div class="tab-content ${!isTextTab ? 'active' : ''}">
                <div class="toggle-row" style="margin-bottom:5px;">
                    <span class="toggle-label">${t.label_stroke} ì‚¬ìš©</span>
                    <input type="checkbox" ${layer.useStroke ? 'checked' : ''} onchange="updateLayer(${idx}, 'useStroke', this)">
                </div>
                <div class="sub-option-box">
                    <label>${t.label_layer_thickness}</label>
                    <input type="range" min="0" max="40" value="${layer.strokeWidth}" oninput="updateLayer(${idx}, 'strokeWidth', this)">
                </div>
                ${generateTabPaletteHTML(idx, 'outline')}
            </div>

            <div style="margin-top:10px; opacity:0.6;">
                <label>${t.label_pos_layer}</label>
                <input type="range" min="0" max="100" value="${(layer.x / 1280) * 100}" oninput="updateLayer(${idx}, 'posX', this)">
                <input type="range" min="0" max="100" value="${(layer.y / 720) * 100}" oninput="updateLayer(${idx}, 'posY', this)">
            </div>
        `;
        container.appendChild(div);
    });
}

function renderBorderPalette() {
    const container16 = document.getElementById('borderPalette16');
    const containerCustom = document.getElementById('borderPaletteCustom');
    const preview = document.getElementById('borderPreviewBox');
    const colorVal = document.getElementById('borderColor').value;
    
    let html16 = '';
    smartColors.forEach(c => {
        html16 += `<div class="color-cell" style="background:${c}" onclick="updateBorderColor('${c}', false)"></div>`;
    });
    container16.innerHTML = html16;
    
    let htmlCustom = '';
    customPalette.forEach(c => {
        if(c) htmlCustom += `<div class="color-cell" style="background:${c}" onclick="updateBorderColor('${c}', false)"></div>`;
        else htmlCustom += `<div class="color-cell empty"></div>`;
    });
    containerCustom.innerHTML = htmlCustom;
    
    preview.style.backgroundColor = colorVal;
}

function updateBorderColor(color, fromInput) {
    document.getElementById('borderColor').value = color;
    document.getElementById('borderPreviewBox').style.backgroundColor = color;
    drawCanvas();
}

function saveToCustomPalette(color) {
    const emptyIdx = customPalette.indexOf(null);
    if (emptyIdx !== -1) customPalette[emptyIdx] = color;
    else { customPalette.shift(); customPalette.push(color); }
    renderLayersUI();
    renderBorderPalette();
}
function saveToCustomPaletteFromBorder() {
    saveToCustomPalette(document.getElementById('borderColor').value);
}

function updateLayer(idx, key, element) {
    let value = element.value;
    if (element.type === 'checkbox') value = element.checked;
    if (key === 'fontSize' || key === 'strokeWidth' || key === 'posX' || key === 'posY') value = parseInt(value);
    
    if (key === 'posX') layers[idx].x = (value / 100) * 1280;
    else if (key === 'posY') layers[idx].y = (value / 100) * 720;
    else layers[idx][key] = value;
    
    drawCanvas();
    if(key === 'color' || key === 'strokeColor') renderLayersUI();
}
function toggleStyle(idx, key) {
    layers[idx][key] = !layers[idx][key];
    renderLayersUI(); drawCanvas();
}
function removeLayer(id) {
    layers = layers.filter(l => l.id !== id);
    renderLayersUI(); drawCanvas();
}
function addTextLayer() {
    layers.push({
        id: Date.now(), text: 'NEW TEXT', x: 640, y: 360, fontSize: 80, fontFamily: 'Impact',
        color: '#FFFFFF', useStroke: true, strokeColor: '#000000', strokeWidth: 10,
        isBold: true, isItalic: false, isUnderline: false, useBg: false, bgColor: '#000000',
        activeTab: 'text'
    });
    renderLayersUI(); drawCanvas();
    document.getElementById('section-text').classList.remove('collapsed');
}

function handleImageUpload(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            bgImage = new Image();
            bgImage.onload = function() {
                bgConfig.originalWidth = bgImage.width; bgConfig.originalHeight = bgImage.height; bgConfig.aspectRatio = bgImage.width / bgImage.height;
                if (bgConfig.aspectRatio > 1280/720) { bgConfig.height = 720; bgConfig.width = 720 * bgConfig.aspectRatio; } 
                else { bgConfig.width = 1280; bgConfig.height = 1280 / bgConfig.aspectRatio; }
                bgConfig.scale = 1; bgConfig.x = 0; bgConfig.y = 0;
                document.getElementById('bgWidth').value = Math.round(bgConfig.width);
                document.getElementById('bgHeight').value = Math.round(bgConfig.height);
                document.getElementById('bgControlPanel').style.display = 'block';
                document.getElementById('section-bg').classList.remove('collapsed');
                drawCanvas();
            };
            bgImage.src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}
function updateBgLock() { bgConfig.isLocked = document.getElementById('bgLock').checked; }
function updateBgSize(mode) {
    const isRatio = document.getElementById('bgRatio').checked;
    if (mode === 'w') {
        const w = parseFloat(document.getElementById('bgWidth').value); bgConfig.width = w;
        if (isRatio) { bgConfig.height = w / bgConfig.aspectRatio; document.getElementById('bgHeight').value = Math.round(bgConfig.height); }
    } else {
        const h = parseFloat(document.getElementById('bgHeight').value); bgConfig.height = h;
        if (isRatio) { bgConfig.width = h * bgConfig.aspectRatio; document.getElementById('bgWidth').value = Math.round(bgConfig.width); }
    }
    drawCanvas();
}
function updateBgScale(val) { bgConfig.scale = val / 100; document.getElementById('scaleValue').innerText = val + '%'; drawCanvas(); }
function updateBgPos(source) {
    if (source === 'input') {
        bgConfig.x = parseFloat(document.getElementById('bgX').value); bgConfig.y = parseFloat(document.getElementById('bgY').value);
        document.getElementById('bgXSlider').value = bgConfig.x; document.getElementById('bgYSlider').value = bgConfig.y;
    } else {
        bgConfig.x = parseFloat(document.getElementById('bgXSlider').value); bgConfig.y = parseFloat(document.getElementById('bgYSlider').value);
        document.getElementById('bgX').value = bgConfig.x; document.getElementById('bgY').value = bgConfig.y;
    }
    drawCanvas();
}
function resetBgImage() {
    if (!bgImage) return;
    bgConfig.scale = 1; bgConfig.x = 0; bgConfig.y = 0;
    document.getElementById('bgScaleSlider').value = 100; document.getElementById('bgX').value = 0; document.getElementById('bgY').value = 0;
    document.getElementById('bgXSlider').value = 0; document.getElementById('bgYSlider').value = 0;
    drawCanvas();
}

function toggleGrid(num) {
    if (activeGrid === num) { activeGrid = 0; document.getElementById('checkGrid6').checked = false; document.getElementById('checkGrid12').checked = false; }
    else { activeGrid = num; document.getElementById('checkGrid6').checked = (num === 6); document.getElementById('checkGrid12').checked = (num === 12); }
    drawCanvas();
}
function downloadImage() {
    const link = document.createElement('a'); link.download = 'thumbnail.png'; link.href = canvas.toDataURL('image/png'); link.click();
}
function applyPreset(type) {
    if (layers.length === 0) addTextLayer();
    const l = layers[0];
    switch(type) {
        case 'center-big': l.x = 640; l.y = 360; l.fontSize = 150; l.text = "ì¶©ê²© ì‹¤í™”"; l.color = "#FFFFFF"; l.strokeColor="#000000"; l.strokeWidth=20; break;
        case 'left-hook': l.x = 300; l.y = 360; l.fontSize = 100; l.textAlign = 'left'; break;
        case 'split-contrast': l.x = 320; l.y = 360; l.fontSize = 90; l.text = "ì™¼ìª½"; layers.push({...l, id: Date.now(), x: 960, text: "ì˜¤ë¥¸ìª½", color: "#FFFF00"}); break;
        case 'bottom-story': l.x = 640; l.y = 600; l.fontSize = 60; l.useBg = true; break;
        case 'corner-badge': l.x = 150; l.y = 100; l.fontSize = 50; l.useBg = true; l.bgColor = "#FF0000"; l.text="HOT"; break;
        case 'diagonal-dynamic': l.x = 640; l.y = 360; l.fontSize = 120; l.isItalic = true; l.text="ë‹¤ì´ë‚´ë¯¹!"; break;
        case 'top-title': l.x = 640; l.y = 100; l.fontSize = 100; l.text = "ë©”ì¸ ì œëª©"; l.useBg=true; l.bgColor="rgba(0,0,0,0.5)"; break;
        case 'right-hook': l.x = 980; l.y = 360; l.fontSize = 100; l.text = "í•µì‹¬ ìš”ì•½"; break;
        case 'four-corners': layers = []; addTextLayer(); layers[0].x = 150; layers[0].y = 100; layers[0].text="1íƒ„"; layers[0].fontSize=60; addTextLayer(); layers[1].x = 1130; layers[1].y = 100; layers[1].text="2íƒ„"; layers[1].fontSize=60; addTextLayer(); layers[2].x = 150; layers[2].y = 620; layers[2].text="3íƒ„"; layers[2].fontSize=60; addTextLayer(); layers[3].x = 1130; layers[3].y = 620; layers[3].text="4íƒ„"; layers[3].fontSize=60; break;
        case 'cinematic-title': l.x = 640; l.y = 360; l.fontSize = 60; l.fontFamily="serif"; l.text="T H E   M O V I E"; l.strokeWidth=2; break;
        case 'versus-mode': layers = []; addTextLayer(); layers[0].x = 300; layers[0].y = 360; layers[0].text="ê°¤ëŸ­ì‹œ"; layers[0].color="#00FFFF"; addTextLayer(); layers[1].x = 980; layers[1].y = 360; layers[1].text="ì•„ì´í°"; layers[1].color="#FF00FF"; addTextLayer(); layers[2].x = 640; layers[2].y = 360; layers[2].text="VS"; layers[2].fontSize=150; layers[2].color="#FFD700"; break;
        case 'speech-bubble': l.x = 640; l.y = 360; l.fontSize = 50; l.text="ë§í’ì„  ëŠë‚Œ"; l.useBg = true; l.bgColor="#FFFFFF"; l.color="#000000"; l.strokeWidth=0; break;
    }
    drawCanvas(); renderLayersUI();
}

canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left) * (canvas.width / rect.width);
    const y = (e.clientY - rect.top) * (canvas.height / rect.height);
    for (let i = layers.length - 1; i >= 0; i--) {
        const l = layers[i]; ctx.font = `${l.fontSize}px "${l.fontFamily}"`;
        const metrics = ctx.measureText(l.text);
        if (x >= l.x - metrics.width/2 && x <= l.x + metrics.width/2 && y >= l.y - l.fontSize/2 && y <= l.y + l.fontSize/2) {
            dragLayerIndex = i; isDragging = true; dragStart = { x: x - l.x, y: y - l.y };
            renderLayersUI(); return;
        }
    }
});
canvas.addEventListener('mousemove', e => {
    if (!isDragging || dragLayerIndex === -1) return;
    const rect = canvas.getBoundingClientRect();
    let x = (e.clientX - rect.left) * (canvas.width / rect.width);
    let y = (e.clientY - rect.top) * (canvas.height / rect.height);
    if (activeGrid > 0) {
        const stepX = 1280 / activeGrid; const stepY = 720 / activeGrid; const snapDist = 20;
        if (Math.abs(x % stepX) < snapDist) x = Math.round(x / stepX) * stepX;
        if (Math.abs(y % stepY) < snapDist) y = Math.round(y / stepY) * stepY;
    }
    layers[dragLayerIndex].x = x - dragStart.x; layers[dragLayerIndex].y = y - dragStart.y;
    drawCanvas();
});
canvas.addEventListener('mouseup', () => { isDragging = false; dragLayerIndex = -1; });

function drawCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (bgImage) {
        const dw = bgConfig.width * bgConfig.scale; const dh = bgConfig.height * bgConfig.scale;
        const dx = bgConfig.x + (1280 - dw) / 2; const dy = bgConfig.y + (720 - dh) / 2;
        ctx.drawImage(bgImage, dx, dy, dw, dh);
    } else {
        ctx.fillStyle = '#111'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#333'; ctx.font = 'bold 40px sans-serif'; ctx.textAlign = 'center'; ctx.fillText('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì„¸ìš”', 640, 360);
    }
    if (document.getElementById('checkGradient').checked) {
        const intensity = document.getElementById('gradIntensity').value / 100;
        const gradient = ctx.createLinearGradient(0, 720 - (300 * intensity), 0, 720);
        gradient.addColorStop(0, "rgba(0,0,0,0)"); gradient.addColorStop(1, `rgba(0,0,0,${0.8 * intensity})`);
        ctx.fillStyle = gradient; ctx.fillRect(0, 0, 1280, 720);
    }
    layers.forEach(layer => {
        ctx.save();
        let fontStyle = ''; if (layer.isItalic) fontStyle += 'italic '; if (layer.isBold) fontStyle += 'bold ';
        ctx.font = `${fontStyle}${layer.fontSize}px "${layer.fontFamily}", sans-serif`;
        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
        if (layer.useBg) {
            const metrics = ctx.measureText(layer.text);
            const bgW = metrics.width + 40; const bgH = layer.fontSize * 1.2;
            ctx.fillStyle = layer.bgColor || 'rgba(0,0,0,0.7)'; ctx.fillRect(layer.x - bgW/2, layer.y - bgH/2, bgW, bgH);
        }
        if (layer.useStroke) {
            ctx.lineWidth = layer.strokeWidth; ctx.strokeStyle = layer.strokeColor; ctx.lineJoin = 'round';
            ctx.strokeText(layer.text, layer.x, layer.y);
        }
        ctx.fillStyle = layer.color; ctx.fillText(layer.text, layer.x, layer.y);
        if (layer.isUnderline) {
            const metrics = ctx.measureText(layer.text); const lineY = layer.y + layer.fontSize * 0.5;
            ctx.beginPath(); ctx.moveTo(layer.x - metrics.width/2, lineY); ctx.lineTo(layer.x + metrics.width/2, lineY);
            ctx.lineWidth = layer.fontSize * 0.05; ctx.strokeStyle = layer.color; ctx.stroke();
        }
        ctx.restore();
    });
    drawOverlays();
}
function drawOverlays() {
    if (document.getElementById('checkBorder').checked) {
        const borderW = document.getElementById('borderWidth').value; const borderR = document.getElementById('borderRadius').value;
        ctx.strokeStyle = document.getElementById('borderColor').value; ctx.lineWidth = borderW;
        ctx.beginPath(); ctx.roundRect(borderW/2, borderW/2, 1280 - borderW, 720 - borderW, borderR); ctx.stroke();
    }
    if (document.getElementById('checkSafeZone').checked) {
        let timeScale = 1;
        if (previewMode === 'main') timeScale = 0.85;
        else if (previewMode === 'mobile') timeScale = 1.6;

        const timeText = "4:14";
        const marginX = 15 * timeScale;
        const marginY = 15 * timeScale;
        const fontSize = 20 * timeScale;
        const iconSize = 18 * timeScale;
        const paddingX = 8 * timeScale;
        
        ctx.save();
        ctx.font = `bold ${fontSize}px sans-serif`;
        const textMetrics = ctx.measureText(timeText);
        const textWidth = textMetrics.width;
        
        const hasMusicIcon = document.getElementById('checkMusicIcon').checked;
        let iconWidth = 0;
        let iconGap = 0;
        
        if (hasMusicIcon) {
            ctx.font = `${iconSize}px FontAwesome`;
            const iconMetrics = ctx.measureText('\uf001');
            iconWidth = iconMetrics.width;
            iconGap = 10 * timeScale;
        }
        
        const boxHeight = 36 * timeScale;
        const contentWidth = textWidth + iconWidth + iconGap;
        const boxWidth = contentWidth + (paddingX * 2);
        
        const boxX = 1280 - boxWidth - marginX;
        const boxY = 720 - boxHeight - marginY;
        
        ctx.strokeStyle = '#FFD700';
        ctx.lineWidth = 3;
        ctx.setLineDash([8, 6]);
        ctx.beginPath();
        ctx.roundRect(boxX - 5, boxY - 5, boxWidth + 10, boxHeight + 10, 8 * timeScale);
        ctx.stroke();
        
        ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
        ctx.beginPath();
        ctx.roundRect(boxX, boxY, boxWidth, boxHeight, 6 * timeScale);
        ctx.fill();

        const contentCenterY = boxY + (boxHeight / 2);
        ctx.textBaseline = 'middle';
        
        let cursorX = boxX + paddingX;

        if (hasMusicIcon) {
             ctx.fillStyle = 'white';
             ctx.font = `${iconSize}px FontAwesome`;
             ctx.textAlign = 'left';
             ctx.fillText('\uf001', cursorX, contentCenterY + (1 * timeScale));
             cursorX += iconWidth + iconGap;
        }

        ctx.fillStyle = 'white';
        ctx.font = `bold ${fontSize}px sans-serif`;
        ctx.textAlign = 'left';
        ctx.fillText(timeText, cursorX, contentCenterY);
        
        ctx.restore();
    }
    
    if (document.getElementById('checkMusicIcon').checked && !document.getElementById('checkSafeZone').checked) {
        ctx.fillStyle = '#ff0000'; ctx.beginPath(); ctx.arc(60, 60, 30, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = 'white'; ctx.font = '30px FontAwesome'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText('\uf001', 60, 60);
    }
    
    // --- ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ ë³€ê²½ (ë…¸ë€ìƒ‰ ì ì„  êµµê²Œ) ---
    if (activeGrid > 0) {
        ctx.save();
        ctx.strokeStyle = '#FFFF00'; // ë…¸ë€ìƒ‰
        ctx.lineWidth = 2; // ì¡°ê¸ˆ ë” êµµê²Œ
        ctx.setLineDash([10, 10]); // ì ì„ 
        ctx.beginPath();
        const stepX = 1280 / activeGrid; const stepY = 720 / activeGrid;
        for (let i = 1; i < activeGrid; i++) { 
            ctx.moveTo(stepX * i, 0); ctx.lineTo(stepX * i, 720); 
            ctx.moveTo(0, stepY * i); ctx.lineTo(1280, stepY * i); 
        }
        ctx.stroke();
        ctx.restore();
    }
}
function toggleSection(id) { document.getElementById(id).classList.toggle('collapsed'); }
function jumpToSection(id, btn) {
    document.getElementById(id).classList.remove('collapsed'); document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'center' });
    document.querySelectorAll('.quick-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active');
}
function playInlineVideo(container, videoId) {
    container.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&playsinline=1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="position:absolute; top:0; left:0; width:100%; height:100%; border:none;"></iframe>`;
}
function saveSettings() {
    const settings = {
        bgLayer: { x: bgConfig.x, y: bgConfig.y, w: bgConfig.width, h: bgConfig.height, locked: bgConfig.isLocked, aspectRatio: bgConfig.aspectRatio },
        textLayers: layers,
        effects: {
            checkGradient: document.getElementById('checkGradient').checked,
            gradIntensity: document.getElementById('gradIntensity').value,
            checkBorder: document.getElementById('checkBorder').checked,
            borderWidth: document.getElementById('borderWidth').value,
            borderRadius: document.getElementById('borderRadius').value,
            borderColor: document.getElementById('borderColor').value,
            checkSafeZone: document.getElementById('checkSafeZone').checked,
            checkMusicIcon: document.getElementById('checkMusicIcon').checked
        }
    };
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(settings));
    const downloadAnchorNode = document.createElement('a');
    downloadAnchorNode.setAttribute("href", dataStr);
    downloadAnchorNode.setAttribute("download", "thumbnail_settings.json");
    document.body.appendChild(downloadAnchorNode); 
    downloadAnchorNode.click();
    downloadAnchorNode.remove();
}

function loadSettings(input) {
    if (!input.files || !input.files[0]) return;
    const file = input.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const settings = JSON.parse(e.target.result);
            if (settings.textLayers) { layers = settings.textLayers; renderLayersUI(); }
            if (settings.effects) {
                document.getElementById('checkGradient').checked = settings.effects.checkGradient;
                document.getElementById('gradIntensity').value = settings.effects.gradIntensity;
                document.getElementById('checkBorder').checked = settings.effects.checkBorder;
                document.getElementById('borderWidth').value = settings.effects.borderWidth;
                document.getElementById('borderRadius').value = settings.effects.borderRadius;
                document.getElementById('borderColor').value = settings.effects.borderColor;
                document.getElementById('checkSafeZone').checked = settings.effects.checkSafeZone;
                document.getElementById('checkMusicIcon').checked = settings.effects.checkMusicIcon;
            }
            if (settings.bgLayer && bgImage) {
                bgConfig.x = settings.bgLayer.x; bgConfig.y = settings.bgLayer.y; bgConfig.width = settings.bgLayer.w; bgConfig.height = settings.bgLayer.h; bgConfig.isLocked = settings.bgLayer.locked; 
                updateBgPos('input'); updateBgSize('w'); updateBgLock();
            }
            drawCanvas();
            alert("ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.");
        } catch (error) { console.error(error); alert("ì„¤ì • íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); }
    };
    reader.readAsText(file);
    input.value = '';
}
initLayers();
</script>
</body></html>
